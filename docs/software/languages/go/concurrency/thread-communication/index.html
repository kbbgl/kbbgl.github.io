<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-software/languages/go/concurrency/thread_communication" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Thread Communication | Kobbi&#x27;s Knowledgebase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kbbgl.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kbbgl.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kbbgl.github.io/docs/software/languages/go/concurrency/thread-communication"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Thread Communication | Kobbi&#x27;s Knowledgebase"><meta data-rh="true" name="description" content="Threads working together require some form of communication."><meta data-rh="true" property="og:description" content="Threads working together require some form of communication."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kbbgl.github.io/docs/software/languages/go/concurrency/thread-communication"><link data-rh="true" rel="alternate" href="https://kbbgl.github.io/docs/software/languages/go/concurrency/thread-communication" hreflang="en"><link data-rh="true" rel="alternate" href="https://kbbgl.github.io/docs/software/languages/go/concurrency/thread-communication" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kobbi&#39;s Knowledgebase RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kobbi&#39;s Knowledgebase Atom Feed"><link rel="stylesheet" href="/assets/css/styles.735d0977.css">
<script src="/assets/js/runtime~main.045b6c33.js" defer="defer"></script>
<script src="/assets/js/main.2c8157a7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kobbi&#x27;s Knowledgebase</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/cloud_services/aws/configure-aws-cli">Docs</a><a class="navbar__item navbar__link" sidebarid="blogSidebar" href="/blog">Blog</a><a class="navbar__item navbar__link" sidebarid="hackBlogSidebar" href="/hack_blog">Hack Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/cloud_services/aws/configure-aws-cli">cloud_services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/cybersecurity/Encryption/check-cert-cn">cybersecurity</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hardware/cpu/computing-abstraction-layers">hardware</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/welcome">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/os/UNIX/Account Management/Controlling_File_Directory_PERMISSIONS">os</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/software/containerization/docker/admin/get-list-containers-resource-usage">software</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/containerization/docker/admin/get-list-containers-resource-usage">containerization</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/infrastructure/mongodb/mongodb-query-sort-limit-regex">infrastructure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/software/languages/ansible/ansible_cheat_sheet">languages</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/ansible/ansible_cheat_sheet">ansible</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/assembly/assemblers">assembly</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/bash/animation_in_script">bash</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/c/debugging/analyzing_coredump_with_gdb">c</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/erlang/syntax">erlang</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/software/languages/go/channels-and-routines">go</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/channels-and-routines">Channels (chan) and goroutines (Concurrency)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/software/languages/go/concurrency/foundations">concurrency</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/concurrency/foundations">Foundations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/concurrency/dealing-with-threads">Dealing with Threads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/software/languages/go/concurrency/thread-communication">Thread Communication</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/how-to-debug-go-code-delve">Using Delve Debugger</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/functions">Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/go-vc-env">Go Versions and Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/interfaces">Interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/maps">Maps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/run-tests">Run Tests in go</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/slices-and-loops">Slices and Loops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/structs">Struct</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/type-conversion">Type Conversion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/using-package-modules-and-receiver-functions">Package Modules and Receiver Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/variables-and-types">Variables and Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/software/languages/go/writing-from-fs">Writing to Filesystem</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/java/Debugging/Checking_JVMs_running_on_machine">java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/javascript/DevTools/Adding_logs_to_JavaScript_sourcecode">javascript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/powershell/arrays">powershell</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/python/Development Environment/list-pipenv-interpreters">python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/languages/regex/Find_pattern_recursively">regex</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/project_management/jira/keyboard-shortcuts">project_management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/software/version_control_systems/diff-files-ignore-lines">version_control_systems</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">software</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">languages</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">go</span><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">concurrency</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Thread Communication</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Thread Communication</h1></header><p>Threads working together require some form of communication.
There are <strong>inter-thread communications</strong> (ITC) and <strong>inter-process communications</strong> (IPC).
This type of communication falls under two main classes:</p>
<ul>
<li><a href="#memory-sharing">Memory sharing</a> is similar to talking to a person through a whiteboard.</li>
<li>Message passing is similar to talking to a person through sending messages.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-sharing">Memory Sharing<a href="#memory-sharing" class="hash-link" aria-label="Direct link to Memory Sharing" title="Direct link to Memory Sharing">​</a></h2>
<p>All executions share the process&#x27; memory where each execution gets to write the results
of its own computation. We can coordinate the executions so that they collaborate
using the process&#x27; memory.</p>
<p>The memory sharing involves a few layers:</p>
<ul>
<li>main process memory.</li>
<li>system bus.</li>
<li>cache</li>
<li>CPU + threads</li>
</ul>
<p>In a scenario where a thread wants to read data from a memory location (the process&#x27; main memory),
the CPU requests data in the system bus. the system bus forwards the request
to the main memory. The entire memory block is read from the main memory and is placed on the bus.
The bus puts the memory in cache so it&#x27;s closer to the CPU. The CPU uses this cache every time it needs to
access the same data.</p>
<p>In a scenario where thread 1 updates a variable and thread 2 wants to read this updated value, thread 1
updates the variable in cache memory. A <strong>write-through</strong> occurs where the cache line is flushed to main.
The cache line is placed on the bus and the main memory is updated from the bus.
The cache listens to the bus for updates and invalidates the cache line if it detects
the update. Then the CPU where thread 2 lives reads the updated variable.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sharing-a-variable-between-goroutines">Sharing a Variable between goroutines<a href="#sharing-a-variable-between-goroutines" class="hash-link" aria-label="Direct link to Sharing a Variable between goroutines" title="Direct link to Sharing a Variable between goroutines">​</a></h3>
<p>To share a variable between goroutines, we pass the variable&#x27;s memory address (using <code>&amp;variable</code>)
to the function that will run in the goroutine. In the function, we dereference and set the variable.
Then we can reference the variable which will have the updated value after the function run in the goroutine
finishes executing.</p>
<p>When we execute the <code>countdown()</code> function in a separate (from the main goroutine) goroutine,
the Go compiler realizes that we are sharing memory between goroutines and allocates
memory on the heap (instead of the stack). This is called <strong>escaping</strong>. Heap memory is used by all
parts of the process whereas stack memory is used only by one thread.</p>
<p>See <a href="/assets/files/countdown-e0fca66cbeda614c05a58c7283435654.go" target="_blank"><code>countdown.go</code></a> for an example.</p>
<p>We can tell a variable has escaped to heap memory by asking the compiler to show its optimization
decisions:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go tool compile </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> countdown.go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="updating-shared-variables-from-multiple-goroutines">Updating shared variables from multiple goroutines<a href="#updating-shared-variables-from-multiple-goroutines" class="hash-link" aria-label="Direct link to Updating shared variables from multiple goroutines" title="Direct link to Updating shared variables from multiple goroutines">​</a></h3>
<p>To share variables between multiple goroutines, all we need to do is pass the variable that we want to manipulate into the function that is being run in the goroutine.</p>
<p>In [<code>letter_frequency_concurrent.go](./code/letter_frequency_concurrent.go), we can see that the</code>frequency<code>slice of integers is passed into the</code>countLetters` function where the slice is modified.</p>
<p>The program has a race condition though. If we run and compare the results between <code>letter_frequency_concurrent.go</code> and <code>letter_frequency_seq.go</code>, we can see that the letter &#x27;e&#x27; has a different frequency:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> go run docs/software/languages/go/concurrency/code/letter_frequency_concurrent.go </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e-&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e-161063</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> go run docs/software/languages/go/concurrency/code/letter_frequency_seq.go </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e-&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e-178215</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Every time we run <code>letter_frequency_concurrent.go</code>, we will get a different result. This is because the program has a race condition. This means that multiple threads/processes share a resource but step over each other.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="race-conditions">Race Conditions<a href="#race-conditions" class="hash-link" aria-label="Direct link to Race Conditions" title="Direct link to Race Conditions">​</a></h4>
<p>In <a href="/assets/files/race_condition_demo-e34742baf009cdffc857e48304c2ff89.go" target="_blank">`race_condition_demo.go</a>, we can see that we have a variable with an initial value (100) that we pass as a reference to 2 functions that either increase or decrease the value by 10. We run this increase and decrease the same amount of times in its own goroutine so we&#x27;re expecting that after the functions finish, the amount would equal to the initial value. But this doesn&#x27;t happen.</p>
<p>The cause is that the increase/decrease operation is not an <strong>atomic operation</strong>. An atomic operation is an operation that is indivisible and cannot be interrupted. The <code>*money -= 10</code> and <code>*money += 10</code> operations have 3 steps:</p>
<ol>
<li>Read the value of the integer, <code>money</code>.</li>
<li>Modify the value.</li>
<li>Write the modified value back to memory.</li>
</ol>
<p>We can use the <code>sync/atomic</code> and <code>atomic.AddInt32/64</code> that can safely increment or decrement shared variables. Also, if we set the program to use only one processor using <code>GOMAXPROCS=1</code>, all goroutines will run on the same processor and use the same cache so we see the expected behavior:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">GOMAXPROCS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> go run docs/software/languages/go/concurrency/code/race_condition_demo.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spendy Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stingy Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Money </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> bank account:  </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">GOMAXPROCS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> go run docs/software/languages/go/concurrency/code/race_condition_demo.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spendy Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stingy Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Money </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> bank account:  </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using <code>GOMAXPROCS</code> is obviously not a good solution because this would take away the advantage of concurrency.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="solving-race-conditions">Solving Race Conditions<a href="#solving-race-conditions" class="hash-link" aria-label="Direct link to Solving Race Conditions" title="Direct link to Solving Race Conditions">​</a></h4>
<p>There&#x27;s no single technique to solve all race conditions. We need to consider:</p>
<ol>
<li>Is memory sharing really needed for the problem or is there another way to communicate between goroutines? We can use channels as well.</li>
<li>Is there a chance that a race condition can occur with the program?</li>
</ol>
<p>To avoid race conditions, we need good synchronization and communcation with the rest of the goroutines.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="detecting-race-conditions">Detecting Race Conditions<a href="#detecting-race-conditions" class="hash-link" aria-label="Direct link to Detecting Race Conditions" title="Direct link to Detecting Race Conditions">​</a></h4>
<p>We can use the <code>-race</code> command line flag to detect race conditions. The compiler adds special code to all memory accesses to track when goroutines are reading and writing memory and outputs memory locations and source code line numbers where the program read/wrote to, causing a race condition.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/go">go</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/concurrency">concurrency</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/threads">threads</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/software/languages/go/concurrency/dealing-with-threads"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dealing with Threads</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/software/languages/go/how-to-debug-go-code-delve"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using Delve Debugger</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#memory-sharing" class="table-of-contents__link toc-highlight">Memory Sharing</a><ul><li><a href="#sharing-a-variable-between-goroutines" class="table-of-contents__link toc-highlight">Sharing a Variable between goroutines</a></li><li><a href="#updating-shared-variables-from-multiple-goroutines" class="table-of-contents__link toc-highlight">Updating shared variables from multiple goroutines</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Knowledgebase</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Knowledgebase</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/hack_blog">Hack Blog</a></li><li class="footer__item"><a href="https://github.com/kbbgl" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Kobbi's Knowledgebase, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>