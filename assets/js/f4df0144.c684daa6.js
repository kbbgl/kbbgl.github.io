"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[62534],{62148:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>s,contentTitle:()=>n,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var t=o(74848),i=o(28453);const a={slug:"use-local-terraform-provider",title:"How To Use Local Terraform Provider",description:"A tutorial how to use a local Terraform provider",authors:["kgal-akl"],tags:["tutorial","how-to","terraform"]},n=void 0,l={id:"software/infrastructure/terraform/README",title:"How To Use Local Terraform Provider",description:"A tutorial how to use a local Terraform provider",source:"@site/docs/software/infrastructure/terraform/README.md",sourceDirName:"software/infrastructure/terraform",slug:"/software/infrastructure/terraform/use-local-terraform-provider",permalink:"/docs/software/infrastructure/terraform/use-local-terraform-provider",draft:!1,unlisted:!1,tags:[{inline:!0,label:"tutorial",permalink:"/docs/tags/tutorial"},{inline:!0,label:"how-to",permalink:"/docs/tags/how-to"},{inline:!0,label:"terraform",permalink:"/docs/tags/terraform"}],version:"current",frontMatter:{slug:"use-local-terraform-provider",title:"How To Use Local Terraform Provider",description:"A tutorial how to use a local Terraform provider",authors:["kgal-akl"],tags:["tutorial","how-to","terraform"]},sidebar:"docsSidebar",previous:{title:"Redis Cheatsheet",permalink:"/docs/software/infrastructure/redis/redis-cheatsheet"},next:{title:"Get Value of Znode",permalink:"/docs/software/infrastructure/zookeeper/zk-get-key-in-znode"}},s={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create Terraform Local Plugin Directory",id:"create-terraform-local-plugin-directory",level:2},{value:"Build the Provider Locally",id:"build-the-provider-locally",level:2},{value:"Tell Terraform to Use Local Provider",id:"tell-terraform-to-use-local-provider",level:2},{value:"Reinitialize Terraform",id:"reinitialize-terraform",level:2},{value:"After Changes",id:"after-changes",level:3}];function c(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.p,{children:["Let's say we have a repository for our own Terraform provider in ",(0,t.jsx)(r.code,{children:"~/dev/kgal-tf-provider"})," and we want to use it in a ",(0,t.jsx)(r.code,{children:"main.tf"}),". This document explains how to set it up."]}),"\n",(0,t.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"go"})," and ",(0,t.jsx)(r.code,{children:"terraform"})," should be installed."]}),"\n",(0,t.jsx)(r.h2,{id:"create-terraform-local-plugin-directory",children:"Create Terraform Local Plugin Directory"}),"\n",(0,t.jsx)(r.p,{children:"Terraform expects the providers to be found in a specific directory structure."}),"\n",(0,t.jsx)(r.p,{children:"We need to create this directory structure:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"PROVIDER_VERSION=0.0.1\nARCH=darwin_amd64\nPROVIDER_NAME=kgal/tf-provider\nmkdir -p ~/.terraform.d/plugins/local/$PROVIDER_NAME/$PROVIDER_VERSION/$ARCH\n"})}),"\n",(0,t.jsx)(r.p,{children:"In the example above, we're going to be creating this structure for a provider which will be built in aMac OS with Apple Silicon. You will need to modify that according to your system. To see what architecture you have, run:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"go env GOOS GOARCH\ndarwin\namd_64\n"})}),"\n",(0,t.jsx)(r.p,{children:"Once we have the Terraform local plugin directory structure, we can mode to building the provider and moving it to this directory."}),"\n",(0,t.jsx)(r.h2,{id:"build-the-provider-locally",children:"Build the Provider Locally"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cd ~/dev/kgal-tf-provider\ngo mod tidy\ngo build -o ~/.terraform.d/plugins/local/$PROVIDER_NAME/$PROVIDER_VERSION/$ARCH/kgal-tf-provider\n"})}),"\n",(0,t.jsx)(r.h2,{id:"tell-terraform-to-use-local-provider",children:"Tell Terraform to Use Local Provider"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-title=main.tf",children:'terraform {\n  required_providers {\n    kgal-tf = {\n        source = "local/kgal/tf-provider"\n        version = "0.0.1"\n    }\n  }\n}\n\nprovider "kgal-tf" { \n  # ....\n}\n\nresource "some_resource" "test_res" {\n  # ...\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"reinitialize-terraform",children:"Reinitialize Terraform"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"terraform init -upgrade\nterraform plan\nterraform apply\n"})}),"\n",(0,t.jsx)(r.h3,{id:"after-changes",children:"After Changes"}),"\n",(0,t.jsxs)(r.p,{children:["If you need to modify the provider code, you will need to modify the provider version, ",(0,t.jsx)(r.a,{href:"#build-the-provider-locally",children:"rebuild the provider"})," and ",(0,t.jsx)(r.code,{children:"terraform init -upgrade"}),"."]})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,r,o)=>{o.d(r,{R:()=>n,x:()=>l});var t=o(96540);const i={},a=t.createContext(i);function n(e){const r=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:n(e.components),t.createElement(a.Provider,{value:r},e.children)}}}]);