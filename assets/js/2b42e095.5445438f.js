"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[13016],{30391:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>c,metadata:()=>r,toc:()=>o});var s=t(74848),a=t(28453);const c={title:"How to Create an EKS Cluster using eksctl",slug:"how-to-create-eks-cluster-ekctl",app2or:"kgal-akl",tags:["$AWS_PROFILEops","k8s","kubernetes","kubectl","eksctl","eks"]},l=void 0,r={id:"cloud_services/aws/eks",title:"How to Create an EKS Cluster using eksctl",description:"Log Into AWS Using CLI",source:"@site/docs/cloud_services/aws/eks.md",sourceDirName:"cloud_services/aws",slug:"/cloud_services/aws/how-to-create-eks-cluster-ekctl",permalink:"/docs/cloud_services/aws/how-to-create-eks-cluster-ekctl",draft:!1,unlisted:!1,tags:[{inline:!0,label:"$AWS_PROFILEops",permalink:"/docs/tags/aws-profil-eops"},{inline:!0,label:"k8s",permalink:"/docs/tags/k-8-s"},{inline:!0,label:"kubernetes",permalink:"/docs/tags/kubernetes"},{inline:!0,label:"kubectl",permalink:"/docs/tags/kubectl"},{inline:!0,label:"eksctl",permalink:"/docs/tags/eksctl"},{inline:!0,label:"eks",permalink:"/docs/tags/eks"}],version:"current",frontMatter:{title:"How to Create an EKS Cluster using eksctl",slug:"how-to-create-eks-cluster-ekctl",app2or:"kgal-akl",tags:["$AWS_PROFILEops","k8s","kubernetes","kubectl","eksctl","eks"]},sidebar:"docsSidebar",previous:{title:"How to Create Lambda from AWS CLI",permalink:"/docs/cloud_services/aws/create-lambda-aws-cli"},next:{title:"AWS IAM Authentication using IMDSv2",permalink:"/docs/cloud_services/aws/aws-iam-auth-imdsv2"}},i={},o=[{value:"Log Into AWS Using CLI",id:"log-into-aws-using-cli",level:2},{value:"Create Cluster",id:"create-cluster",level:2},{value:"Enable CloudWatch Logging on the EKS for authentication events",id:"enable-cloudwatch-logging-on-the-eks-for-authentication-events",level:2},{value:"Interacting With Cluster",id:"interacting-with-cluster",level:2}];function u(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"log-into-aws-using-cli",children:"Log Into AWS Using CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"aws sso login --profile $AWS_PROFILE\n"})}),"\n",(0,s.jsx)(n.h2,{id:"create-cluster",children:"Create Cluster"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'eksctl create cluster \\\n--name $EKS_CLUSTER_NAME \\\n--region $AWS_REGION \\\n--nodegroup-name "kbbgl-nodegroup" \\\n--node-type "t3.medium" \\\n--nodes 1 \\\n--managed\n'})}),"\n",(0,s.jsx)(n.h2,{id:"enable-cloudwatch-logging-on-the-eks-for-authentication-events",children:"Enable CloudWatch Logging on the EKS for authentication events"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'aws eks update-cluster-config \\\n--name $EKS_CLUSTER_NAME \\\n--region $AWS_REGION \\\n--logging \'{"clusterLogging":[{"types":["authenticator"],"enabled":true}]}\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"interacting-with-cluster",children:"Interacting With Cluster"}),"\n",(0,s.jsx)(n.p,{children:"In cases when we have an existing EKS cluster that we want to interact with once the AWS access token has expired, we need to first reauthenticate with AWS:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"aws sso login --profile $AWS_PROFILE\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Once we're authenticated, we can run the following command to let ",(0,s.jsx)(n.code,{children:"kubectl"})," know that it needs to retrieve the cluster access token using the AWS CLI:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"aws eks update-kubeconfig --region $AWS_REGION --name $EKS_CLUSTER_NAME --profile $AWS_PROFILE\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will update the ",(0,s.jsx)(n.code,{children:".kubeconfig"})," file to include the necessary AWS command to retrieve the secret and allow interaction with the EKS cluster:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS[redacted]\n    server: https://abcdefg.hi2.$AWS_REGION.eks.amazonaws.com\n  name: arn:aws:eks:$AWS_REGION:$AWS_ACCOUNT_ID:cluster/$EKS_CLUSTER_NAME\ncontexts:\n- context:\n    cluster: arn:aws:eks:$AWS_REGION:$AWS_ACCOUNT_ID:cluster/$EKS_CLUSTER_NAME\n    user: arn:aws:eks:$AWS_REGION:$AWS_ACCOUNT_ID:cluster/$EKS_CLUSTER_NAME\n  name: arn:aws:eks:$AWS_REGION:$AWS_ACCOUNT_ID:cluster/$EKS_CLUSTER_NAME\ncurrent-context: arn:aws:eks:$AWS_REGION:$AWS_ACCOUNT_ID:cluster/$EKS_CLUSTER_NAME\nkind: Config\nusers:\n- name: arn:aws:eks:$AWS_REGION:$AWS_ACCOUNT_ID:cluster/$EKS_CLUSTER_NAME\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1beta1\n      args:\n      - --region\n      - $AWS_REGION\n      - eks\n      - get-token\n      - --cluster-name\n      - $EKS_CLUSTER_NAME\n      - --profile\n      - $AWS_PROFILE\n      command: aws\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We can then run ",(0,s.jsx)(n.code,{children:"kubectl"})," commands."]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var s=t(96540);const a={},c=s.createContext(a);function l(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);