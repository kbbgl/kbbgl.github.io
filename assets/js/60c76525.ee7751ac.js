"use strict";(self.webpackChunkkgkb=self.webpackChunkkgkb||[]).push([[76167],{65952:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>c});var i=n(74848),l=n(28453);const t={},r="Filesystems",d={id:"os/UNIX/Filesystem/fs",title:"Filesystems",description:"Applications write and read files. The files are abstractions to the actual physical/hardware layer. The filesystem is an interface between the applications and the I/O layer.",source:"@site/docs/os/UNIX/Filesystem/fs.md",sourceDirName:"os/UNIX/Filesystem",slug:"/os/UNIX/Filesystem/fs",permalink:"/docs/os/UNIX/Filesystem/fs",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Making/Formatting",permalink:"/docs/os/UNIX/Filesystem/formatting"},next:{title:"inodes",permalink:"/docs/os/UNIX/Filesystem/inode"}},o={},c=[{value:"VFS",id:"vfs",level:2},{value:"<code>/boot</code>",id:"boot",level:2},{value:"<code>/dev</code>",id:"dev",level:2},{value:"<code>/etc</code>",id:"etc",level:2},{value:"<code>/lib</code> and <code>/lib64</code>",id:"lib-and-lib64",level:2},{value:"<code>/media</code>",id:"media",level:2},{value:"<code>/mnt</code>",id:"mnt",level:2},{value:"<code>/opt</code>",id:"opt",level:2},{value:"<code>/proc</code>",id:"proc",level:2},{value:"<code>/sys</code>",id:"sys",level:2},{value:"<code>/root</code>",id:"root",level:2},{value:"<code>/tmp</code>",id:"tmp",level:2},{value:"Journaling",id:"journaling",level:2},{value:"inodes",id:"inodes",level:3},{value:"Usage",id:"usage",level:2},{value:"Creating Filesystems",id:"creating-filesystems",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"filesystems",children:"Filesystems"})}),"\n",(0,i.jsx)(s.p,{children:"Applications write and read files. The files are abstractions to the actual physical/hardware layer. The filesystem is an interface between the applications and the I/O layer."}),"\n",(0,i.jsx)(s.p,{children:"Multiple filesystems are usually merged together to form a unified tree structure."}),"\n",(0,i.jsx)(s.h2,{id:"vfs",children:"VFS"}),"\n",(0,i.jsxs)(s.p,{children:["Linux uses a Virtual File System (",(0,i.jsx)(s.strong,{children:"VFS"}),") to communcate with the filesystem software. When an application needs access to a file, it interacts the the VFS abstraction layer which translates the I/O system calls to specific code relevant to the particular filesystem. This way, the application developer doesn't need to worry about interacting differently with each particular filesystem."]}),"\n",(0,i.jsx)(s.p,{children:"Popular supported Linux filesystems:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"ext2/3/4"})," - Linux default. Newest filesystem and default for majority of distros. Features:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Journaling"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Extent (contiguous blocks which increase performance of large files)"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Backwards compatible with earlier ",(0,i.jsx)(s.code,{children:"ext2/3"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Max file size is 16TB, max filesystem size is 1EB."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Unlimited amount of subdirectories."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"ext4"})," layout:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Disk blocks are partitioned into block groups which contain adjacent inode and data blocks resulting in better performance."}),"\n",(0,i.jsx)(s.li,{children:'Fields are written to disk in little-endian order (The least significant byte (the "little end") of the data is placed at the byte with the lowest address).'}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["the ",(0,i.jsx)(s.code,{children:"ext4"})," superblock contains global information about the filesystem such as mount count, block size, blocks per group, free block count, free inode count and OS system id. The superblock is stored on several block groups."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Block sizes are 512/1024/2048/4096 bytes."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"To see the list of superblocks of a specific :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo dumpe2fs /dev/sda1 | grep superblock\n"})}),"\n",(0,i.jsx)(s.p,{children:"To modify a speific filesystem:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# change number of max mounts\nsudo tune2fs -c 25 /dev/sda1\n\n# change interval maximal between filesystem chceks\nsudo tune2fs -i 10 /dev/sda1\n\n# list contents of superblocl\nsudo tunefs -l /dev/sda1\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"xfs"})," - RHEL. Engineered to deal with large datasets and effectively handle parallel I/O tasks."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Up to 16 EB for total filesystem."}),"\n",(0,i.jsx)(s.li,{children:"Up to 8 EB for an individual file."}),"\n",(0,i.jsx)(s.li,{children:"Employs Direct Memory Access (DMA) I/O."}),"\n",(0,i.jsx)(s.li,{children:"Guranteeing an I/O rate."}),"\n",(0,i.jsx)(s.li,{children:"Can journal quota information."}),"\n",(0,i.jsxs)(s.li,{children:["Supports ",(0,i.jsx)(s.code,{children:"xattr"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Maintenance can be done while the filesystem is mounted."}),"\n",(0,i.jsxs)(s.li,{children:["Can use ",(0,i.jsx)(s.code,{children:"xfsdump"})," and ",(0,i.jsx)(s.code,{children:"xfsrestore"})," to dump/restore respectively."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"jfs"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"FAT32/64"})," - Windows"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"NTFS"})," - Windows"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"nfs"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"A list of supported filesystem exists:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cat /proc/filesystem\n"})}),"\n",(0,i.jsx)(s.p,{children:"Filesystems can be stored on:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"a physical partition on a disk."}),"\n",(0,i.jsxs)(s.li,{children:["a logical partition controlled by the Logical Volume Manager (",(0,i.jsx)(s.strong,{children:"LVM"}),")."]}),"\n",(0,i.jsxs)(s.li,{children:["a network where it is hidden from the local system. The most popular is Network Shares (",(0,i.jsx)(s.code,{children:"nfs"}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Data distinction:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Shareable vs non-shareable"}),"\n",(0,i.jsx)(s.p,{children:"user home directories are shareable, device lock files are not."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Variable vs static"}),"\n",(0,i.jsx)(s.p,{children:"static data include binaries, docs. variable data includes process information files, etc."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.p,{children:"The standard for filesystem tree is referred to as FHS (File Hierarchy Standard)."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://www.tecmint.com/wp-content/uploads/2013/09/Linux-Directory-Structure.jpeg",alt:"dir-struct"})}),"\n",(0,i.jsx)(s.h2,{id:"boot",children:(0,i.jsx)(s.code,{children:"/boot"})}),"\n",(0,i.jsx)(s.p,{children:"Holds essential files for booting the system.\nSome important ones are:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"vmlinuz"})," - Compressed Linux kernel."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"initramfs/initrd"})," - The initial RAM filesystem/disk which is mounted before the root filesystem becomes available."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"config"})," - Used to configure the kernel compilation."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"System.map"})," - Kernel symbol table. Used for debugging."]}),"\n",(0,i.jsx)(s.h2,{id:"dev",children:(0,i.jsx)(s.code,{children:"/dev"})}),"\n",(0,i.jsx)(s.p,{children:"Pseudo-filesystem.\nContains I/O devices files/nodes built into the system which are used to read/write to/from a peripheral hardware device. This directory does not include network interfaces."}),"\n",(0,i.jsx)(s.h2,{id:"etc",children:(0,i.jsx)(s.code,{children:"/etc"})}),"\n",(0,i.jsx)(s.p,{children:"Contains configuration files and startup scripts. Different distributions often add their own configuration files and directories under it."}),"\n",(0,i.jsx)(s.p,{children:"Important files:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"/etc/systemd"})," - Contains configuration scripts for interacting with system services."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"/etc/initd"})," - Constains startup and shutdown scripts"]}),"\n",(0,i.jsxs)(s.h2,{id:"lib-and-lib64",children:[(0,i.jsx)(s.code,{children:"/lib"})," and ",(0,i.jsx)(s.code,{children:"/lib64"})]}),"\n",(0,i.jsx)(s.p,{children:"These directories should contain only those libraries needed to execute the binaries in /bin and /sbin. These libraries are particularly important for booting the system and executing commands within the root filesystem."}),"\n",(0,i.jsxs)(s.p,{children:["Kernel modules (often device or filesystem drivers) are located under ",(0,i.jsx)(s.code,{children:"/lib/modules/<kernel-version-number>"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["PAM (Pluggable Authentication Modules) files are stored in ",(0,i.jsx)(s.code,{children:"/lib/security"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"media",children:(0,i.jsx)(s.code,{children:"/media"})}),"\n",(0,i.jsx)(s.p,{children:"This directory was typically used to mount filesystems on removable media. These include CDs, DVDs, and USB drives, and even Paleolithic era floppies."}),"\n",(0,i.jsx)(s.h2,{id:"mnt",children:(0,i.jsx)(s.code,{children:"/mnt"})}),"\n",(0,i.jsx)(s.p,{children:"This directory is provided so that the system administrator can temporarily mount a filesystem when needed."}),"\n",(0,i.jsx)(s.h2,{id:"opt",children:(0,i.jsx)(s.code,{children:"/opt"})}),"\n",(0,i.jsx)(s.p,{children:"This directory is designed for software packages that wish to keep all or most of their files in one isoated place."}),"\n",(0,i.jsxs)(s.p,{children:["For example, if ",(0,i.jsx)(s.code,{children:"dolphy_app"})," were the name of a package which resided under ",(0,i.jsx)(s.code,{children:"/opt"}),", then all of its files should reside in directories under ",(0,i.jsx)(s.code,{children:"/opt/dolphy_app"}),", including ",(0,i.jsx)(s.code,{children:"/opt/dolphy_app/bin"})," for binaries and ",(0,i.jsx)(s.code,{children:"/opt/dolphy_app/man"})," for any ",(0,i.jsx)(s.code,{children:"man"})," pages."]}),"\n",(0,i.jsx)(s.h2,{id:"proc",children:(0,i.jsx)(s.code,{children:"/proc"})}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Synthetic_file_system",children:"synthetic/pseudo-filesystem"})," which contains directories with virtual files full of processes and system information. All information written to this directory is in memory."]}),"\n",(0,i.jsx)(s.h2,{id:"sys",children:(0,i.jsx)(s.code,{children:"/sys"})}),"\n",(0,i.jsx)(s.p,{children:"Also a pseudo-filesystem that contains information about devices, drivers, kernel modules, system configuration. It is used both to gather and modify the behavior of the system."}),"\n",(0,i.jsx)(s.h2,{id:"root",children:(0,i.jsx)(s.code,{children:"/root"})}),"\n",(0,i.jsxs)(s.p,{children:["Home directory of ",(0,i.jsx)(s.code,{children:"root"})," user."]}),"\n",(0,i.jsx)(s.h2,{id:"tmp",children:(0,i.jsx)(s.code,{children:"/tmp"})}),"\n",(0,i.jsx)(s.p,{children:"Directory for temporary files that are usually cleared automatically (depending on the distro). This directory should not be used to store very large files as it is stored in RAM."}),"\n",(0,i.jsx)(s.h2,{id:"journaling",children:"Journaling"}),"\n",(0,i.jsx)(s.p,{children:"Filesystems that are journaled have the ability to recover from system crashes and ungraceful shutdowns. This is because all operations on the filesystem are grouped into transactions which must each atomically succeed. If the transaction fails, no changes are made on the filesystem. A log file is maintained of all transactions."}),"\n",(0,i.jsx)(s.h3,{id:"inodes",children:"inodes"}),"\n",(0,i.jsx)(s.p,{children:"Inodes are data structures on a disk that contain metadata about files. Each file is represented by one inode. All I/O activity moves both the file and the inode of the file."}),"\n",(0,i.jsx)(s.p,{children:"Inodes contain:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Permissions"}),"\n",(0,i.jsx)(s.li,{children:"User/group ownership"}),"\n",(0,i.jsx)(s.li,{children:"Size"}),"\n",(0,i.jsxs)(s.li,{children:["Last update time ( in ",(0,i.jsx)(s.code,{children:"ns"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Last modification time ( in ",(0,i.jsx)(s.code,{children:"ns"}),")"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"The file names are stored on the directory file and associates the file name and the inode. The association can be:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Hard link"})," - pointer to the inode. Hard link files need to be on the same filesystem."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Soft/Symbolic link"})," -  pointer to a file name which has an associated inode."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["We can use ",(0,i.jsx)(s.code,{children:"ln"})," to create links:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ln -s file file-soft\nln file file-hard\n"})}),"\n",(0,i.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Prints all filesystems and their capacity/type\ndf -hT\n\n# disk usage \ndu -h /var/log/some_app\n"})}),"\n",(0,i.jsx)(s.h2,{id:"creating-filesystems",children:"Creating Filesystems"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo fdisk /dev/sda1\n\n-> n\n-> p/e\n"})})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>d});var i=n(96540);const l={},t=i.createContext(l);function r(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);