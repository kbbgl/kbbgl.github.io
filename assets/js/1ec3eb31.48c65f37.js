"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[85290],{48605:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>r});var t=o(74848),l=o(28453);const s={},a=void 0,i={id:"software/containerization/k8s/Deployments/Scaling_and_Rolling_Updates",title:"Scaling_and_Rolling_Updates",description:"Scaling and Rolling Updates",source:"@site/docs/software/containerization/k8s/Deployments/Scaling_and_Rolling_Updates.md",sourceDirName:"software/containerization/k8s/Deployments",slug:"/software/containerization/k8s/Deployments/Scaling_and_Rolling_Updates",permalink:"/docs/software/containerization/k8s/Deployments/Scaling_and_Rolling_Updates",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Overview",permalink:"/docs/software/containerization/k8s/Deployments/Overview"},next:{title:"Using_DaemonSets",permalink:"/docs/software/containerization/k8s/Deployments/Using_DaemonSets"}},c={},r=[{value:"Scaling and Rolling Updates",id:"scaling-and-rolling-updates",level:2},{value:"Rollbacks",id:"rollbacks",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"scaling-and-rolling-updates",children:"Scaling and Rolling Updates"}),"\n",(0,t.jsx)(n.p,{children:"To scale a deployment:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl scale deploy/dev-web --replicas=4\n"})}),"\n",(0,t.jsx)(n.p,{children:"To trigger a rolling update, we can change the image of a container:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl edit deployment nginx\n\n...\ncontainers:\n  - image: nginx: 1.8 # change to older value\n...\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rollbacks",children:"Rollbacks"}),"\n",(0,t.jsxs)(n.p,{children:["using the ",(0,t.jsx)(n.code,{children:"--record"})," option of the ",(0,t.jsx)(n.code,{children:"kubectl create"})," command, which allows annotation in the resource definition."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl create deploy ghost --image=ghost --record\n\n$ kubectl get deployments ghost -o yaml\ndeployment.kubernetes.io/revision: "1" \nkubernetes.io/change-cause: kubectl create deploy ghost --image=ghost --record\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Should an update fail, due to an improper image version, for example, you can roll back the change to a working version with ",(0,t.jsx)(n.code,{children:"kubectl rollout"})," undo:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl set image deployment/ghost ghost=ghost:09 --all\n\nkubectl rollout history deployment/ghost deployments "ghost":\nREVISION   CHANGE-CAUSE\n1 \u200b         kubectl create deploy ghost --image=ghost --record\n2          kubectl set image deployment/ghost ghost=ghost:09 --all\n\nkubectl get pods\nNAME                    READY  STATUS            RESTARTS  AGE\nghost-2141819201-tcths  0/1    ImagePullBackOff  0         1m\u200b\n\nkubectl rollout undo deployment/ghost ; kubectl get pods\n\nNAME                    READY  STATUS   RESTARTS  AGE\nghost-3378155678-eq5i6  1/1    Running  0         7s\n'})}),"\n",(0,t.jsxs)(n.p,{children:["You can roll back to a specific revision with the ",(0,t.jsx)(n.code,{children:"--to-revision=2"})," option."]}),"\n",(0,t.jsxs)(n.p,{children:["You can also edit a Deployment using the ",(0,t.jsx)(n.code,{children:"kubectl edit"})," command."]}),"\n",(0,t.jsx)(n.p,{children:"You can also pause a Deployment, and then resume."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl rollout pause deployment/ghost\n\nkubectl rollout resume deployment/ghost\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Can still do a rolling update on ",(0,t.jsx)(n.code,{children:"ReplicationControllers"})," with the ",(0,t.jsx)(n.code,{children:"kubectl rolling-update"})," command, but this is done on the client side. Hence, if you close your client, the rolling update will stop."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>i});var t=o(96540);const l={},s=t.createContext(l);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);