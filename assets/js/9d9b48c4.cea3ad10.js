"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[75200],{16085:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>i,default:()=>o,frontMatter:()=>c,metadata:()=>l,toc:()=>d});var a=n(74848),t=n(28453);const c={slug:"akeyless-cli-cheatsheet",title:"Akeyless CLI Cheatsheet",description:"Akeyless CLI Cheatsheet",authors:["kgal-akl"],tags:["akeyless","cli","cheatsheet"]},i=void 0,l={id:"cybersecurity/secrets_management/akeyless/cli",title:"Akeyless CLI Cheatsheet",description:"Akeyless CLI Cheatsheet",source:"@site/docs/cybersecurity/secrets_management/akeyless/cli.md",sourceDirName:"cybersecurity/secrets_management/akeyless",slug:"/cybersecurity/secrets_management/akeyless/akeyless-cli-cheatsheet",permalink:"/docs/cybersecurity/secrets_management/akeyless/akeyless-cli-cheatsheet",draft:!1,unlisted:!1,tags:[{inline:!0,label:"akeyless",permalink:"/docs/tags/akeyless"},{inline:!0,label:"cli",permalink:"/docs/tags/cli"},{inline:!0,label:"cheatsheet",permalink:"/docs/tags/cheatsheet"}],version:"current",frontMatter:{slug:"akeyless-cli-cheatsheet",title:"Akeyless CLI Cheatsheet",description:"Akeyless CLI Cheatsheet",authors:["kgal-akl"],tags:["akeyless","cli","cheatsheet"]},sidebar:"docsSidebar",previous:{title:"Staying Anonymous",permalink:"/docs/cybersecurity/Offensive/staying-anon"},next:{title:"AWS CLI Cheatsheet",permalink:"/docs/cloud_services/aws/aws-cli-cheatsheet"}},r={},d=[{value:"Authentication",id:"authentication",level:2},{value:"SAML",id:"saml",level:3},{value:"AWS IAM",id:"aws-iam",level:3},{value:"GCP IAM/SA",id:"gcp-iamsa",level:3},{value:"Azure",id:"azure",level:3},{value:"Create Auth Method",id:"create-auth-method",level:4},{value:"Get JWT from T-Token",id:"get-jwt-from-t-token",level:4},{value:"Get Cloud Identity",id:"get-cloud-identity",level:4},{value:"LDAP",id:"ldap",level:3},{value:"Authenticate using Universal ID",id:"authenticate-using-universal-id",level:3},{value:"Kubernetes",id:"kubernetes",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Use Gateway",id:"use-gateway",level:3},{value:"Define a Profile",id:"define-a-profile",level:3},{value:"Configure CLI to use SAML",id:"configure-cli-to-use-saml",level:3},{value:"Configure CLI to use AWS IAM",id:"configure-cli-to-use-aws-iam",level:3},{value:"Configure CLI to use different tenant",id:"configure-cli-to-use-different-tenant",level:3},{value:"Secrets",id:"secrets",level:2},{value:"Get Secret Value",id:"get-secret-value",level:3},{value:"Create Secret",id:"create-secret",level:3},{value:"Delete Secret",id:"delete-secret",level:3},{value:"Create Google Workspace Dynamic Secret",id:"create-google-workspace-dynamic-secret",level:3},{value:"SRA",id:"sra",level:2},{value:"Connect to EKS Target",id:"connect-to-eks-target",level:3},{value:"Connect to SSH Target",id:"connect-to-ssh-target",level:3},{value:"Certificates",id:"certificates",level:2},{value:"Create a Certificate",id:"create-a-certificate",level:3},{value:"Get Certificate and Private Key",id:"get-certificate-and-private-key",level:3},{value:"Get Certificate Public Key",id:"get-certificate-public-key",level:3}];function h(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h2,{id:"authentication",children:"Authentication"}),"\n",(0,a.jsx)(s.h3,{id:"saml",children:"SAML"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless auth --access-id $SAML_ACCESS_ID --access-type saml\n"})}),"\n",(0,a.jsx)(s.h3,{id:"aws-iam",children:"AWS IAM"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless auth --access-id $AWS_IAM_ACCESS_ID --access-type aws_iam --debug\n"})}),"\n",(0,a.jsx)(s.h3,{id:"gcp-iamsa",children:"GCP IAM/SA"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"GOOGLE_APPLICATION_CREDENTIALS=/path/to/gcp/app.json \nakeyless auth --access-id $GCP_IAM_ACCESS_ID --access-type gcp\n"})}),"\n",(0,a.jsx)(s.h3,{id:"azure",children:"Azure"}),"\n",(0,a.jsx)(s.h4,{id:"create-auth-method",children:"Create Auth Method"}),"\n",(0,a.jsxs)(s.p,{children:["Get the ",(0,a.jsx)(s.code,{children:"AZURE_TENANT_ID"})," by ",(0,a.jsx)(s.a,{href:"/docs/cloud_services/azure/managing-azure-account#retrieve-tenant-id",children:"retreiving the Tenant ID"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'AZURE_TENANT_ID=$(az account show \\\n--query tenantId \\\n--output tsv)\n\nakeyless create-auth-method-azure-ad \\\n--name "$AUTH_METHOD_NAME" \\\n--bound-tenant-id "$AZURE_TENANT_ID" \\\n--profile kgal-azure-dev-gw-admin;\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Make sure to ",(0,a.jsx)(s.a,{href:"/docs/cloud_services/azure/managing-azure-vm#assign-a-managed-identity-to-vm",children:"enable a managed idenitity"}),"."]}),"\n",(0,a.jsx)(s.p,{children:"Then authenticate:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless auth \\\n--access-id $AZURE_AD_AKEYLESS_ACCESS_ID \\\n--access-type azure_ad\n"})}),"\n",(0,a.jsx)(s.h4,{id:"get-jwt-from-t-token",children:"Get JWT from T-Token"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless validate-token --token $AKEYLESS_T_TOKEN --debug\n"})}),"\n",(0,a.jsx)(s.h4,{id:"get-cloud-identity",children:"Get Cloud Identity"}),"\n",(0,a.jsxs)(s.p,{children:["We can run this within a cloud provider environment to retrieve the cloud ID and use it to authenticate to ",(0,a.jsx)(s.a,{href:"/docs/cybersecurity/secrets_management/akeyless/akeyless-cli-cheatsheet#aws-iam",children:"AWS"}),", ",(0,a.jsx)(s.a,{href:"/docs/cybersecurity/secrets_management/akeyless/akeyless-cli-cheatsheet#azure",children:"Azure"})," or ",(0,a.jsx)(s.a,{href:"/docs/cybersecurity/secrets_management/akeyless/akeyless-cli-cheatsheet#gcp-iamsa",children:"GCP"})]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless get-cloud-identity --describe-sub-claims\nakeyless auth gcp --access-id $GCP_IAM_ACCESS_ID --cloud-id $CLOUD_ID\n"})}),"\n",(0,a.jsx)(s.h3,{id:"ldap",children:"LDAP"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'akeyless auth \\\n--username "$LDAP_USERNAME" \\\n--password "$LDAP_PASSWORD" \\\n--access-type ldap \\\n--access-id $LDAP_ACCESS_ID \\\n--ldap_proxy_url http://localhost:8000\n'})}),"\n",(0,a.jsx)(s.h3,{id:"authenticate-using-universal-id",children:"Authenticate using Universal ID"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'AKEYLESS_GATEWAY_URL=https://kgal-ec2.dev/api/v1\nakeyless uid-generate-token \\\n--auth-method-name "$AUTH_METHOD_NAME"\\\n--profile $AKEYLESS_PROFILE\n'})}),"\n",(0,a.jsx)(s.h3,{id:"kubernetes",children:"Kubernetes"}),"\n",(0,a.jsx)(s.p,{children:"If we're authenticating from within a cluster (e.g inside an Akeyless Gateway container)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'akeyless auth \\\n--access-type k8s \\\n--access-id "$ACCESS_ID" \\\n--k8s-auth-config-name "$K8S_AUTH_CONF_NAME" \\\n--gateway-url "http://localhost:8000"\n'})}),"\n",(0,a.jsx)(s.p,{children:"Or using the service account JWT when authenticating outside the cluster:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'B64_ENCODED_JWT=(echo "eJ..." | base64 | tr -d \'\\n\')\n akeyless auth \\\n--access-type k8s \\\n--access-id "$ACCESS_ID" \\\n--k8s-auth-config-name "$K8S_AUTH_CONF_NAME" \\\n--k8s-service-account-token  "$B64_ENCODED_JWT" \\\n--gateway-url "http://localhost:8000"\n'})}),"\n",(0,a.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(s.h3,{id:"use-gateway",children:"Use Gateway"}),"\n",(0,a.jsx)(s.p,{children:"To make calls to the Gateway, set:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'AKEYLESS_GATEWAY_URL="$GATEWAY_FQDN/api/v1" \n\nakeyless get-secret-value --profile $MY_PROFILE --name $SECRET_NAME\n'})}),"\n",(0,a.jsx)(s.h3,{id:"define-a-profile",children:"Define a Profile"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'AKEYLESS_PROFILE="global-staging-api-key"\nakeyless configure \\\n--profile "$AKEYLESS_PROFILE" \\\n--access-id "$AKEYLESS_ACCESS_ID" \\\n--access-key "$AKEYLESS_ACCESS_KEY" \\\n--gateway-url "http://localhost:8000"\n\ncat /Users/kgal/.akeyless/profiles/$AKEYLESS_PROFILE.toml\n'})}),"\n",(0,a.jsx)(s.h3,{id:"configure-cli-to-use-saml",children:"Configure CLI to use SAML"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless configure --profile $AKEYLESS_PROFILE --access-id $SAML_ACCESS_ID --access-type saml\n"})}),"\n",(0,a.jsx)(s.h3,{id:"configure-cli-to-use-aws-iam",children:"Configure CLI to use AWS IAM"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless configure --profile $AKEYLESS_PROFILE --access-id $AWS_IAM_ACCESS_ID --access-type aws_iam\n"})}),"\n",(0,a.jsx)(s.h3,{id:"configure-cli-to-use-different-tenant",children:"Configure CLI to use different tenant"}),"\n",(0,a.jsxs)(s.p,{children:["set the ",(0,a.jsx)(s.code,{children:"dns"})," field in ",(0,a.jsx)(s.code,{children:"~/.akeyless/settings"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"secrets",children:"Secrets"}),"\n",(0,a.jsx)(s.h3,{id:"get-secret-value",children:"Get Secret Value"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'akeyless get-secret-value --name "$SECRET_NAME"\n'})}),"\n",(0,a.jsx)(s.h3,{id:"create-secret",children:"Create Secret"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'SECRET_NAME="test"\nakeyless create-secret --name $SECRET_NAME --value noSecret --type generic\n\nA new secret named /test was successfully created\n'})}),"\n",(0,a.jsx)(s.h3,{id:"delete-secret",children:"Delete Secret"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless delete-item --name $SECRET_NAME\n\nItem /test was successfully deleted\n"})}),"\n",(0,a.jsx)(s.h3,{id:"create-google-workspace-dynamic-secret",children:"Create Google Workspace Dynamic Secret"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'GWORKSPACE_DS_NAME="test-gworkspace-ds"\nakeyless dynamic-secret create google-workspace \\\n--name $GWORKSPACE_DS_NAME \\\n--target-name "$GWORKSPACE_DS_NAME-target" \\\n--access-mode role \\\n--admin-email kbbgl@github.io \\\n--role-name "$GCP_ROLE_NAME" \\\n--role-scope CUSTOMER \\\n--user-ttl 60m \\\n--profile $AKEYLESS_PROFILE \\\n--gateway-url http://localhost:8000\n\nDynamic secret test-gworkspace-ds successfully created\n- Dynamic secret ID: 1\n'})}),"\n",(0,a.jsx)(s.h2,{id:"sra",children:"SRA"}),"\n",(0,a.jsx)(s.h3,{id:"connect-to-eks-target",children:"Connect to EKS Target"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless connect \\\n--target default@$EKS_CLUSTER_ID.$AWS_REGION.eks.amazonaws.com \\\n--name /eks/eks-ds \\\n--cert-issuer /8-ssh/issuer-compose \\\n--via-sra localhost:2222\n--gateway-url http://localhost:8000 \\\n--profile $AKEYLESS_PROFILE\n"})}),"\n",(0,a.jsxs)(s.p,{children:["We can add ",(0,a.jsx)(s.code,{children:"--debug"})," to see some details about the command that is being run to set up the connection."]}),"\n",(0,a.jsx)(s.h3,{id:"connect-to-ssh-target",children:"Connect to SSH Target"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'akeyless connect \n--target "$SSH_USER@$SSH_SERVER_IP:$SSH_SERVER_PORT" \\\n--cert-issuer-name "$CERT_ISSUER_NAME" \\\n--gateway-rest-endpoint "$GW_CONFIG_URL/api" \\\n--debug\n'})}),"\n",(0,a.jsx)(s.p,{children:"This will work if we have the following settings:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"~/.akeyless-connect.rc"})," doesn't exists."]}),"\n",(0,a.jsxs)(s.li,{children:["The certificate issuer includes the ",(0,a.jsx)(s.code,{children:"$SSH_USER"})," and ",(0,a.jsx)(s.code,{children:"session_*"})," in allowed users:"]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'akeyless describe-item --name "$CERT_ISSUER_NAME"\n'})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'{\n  "item_name": "$CERT_ISSUER_NAME",\n  "cert_issuer_signer_key_name": "$CERT_ISSUER_SIGNING_KEY",\n  "certificate_issue_details": {\n    "ssh_cert_issuer_details": {\n      "allowed_users": [\n        "$SSH_USER",\n        "session_*"\n      ]\n    }\n  },\n  "item_general_info": {\n    "cert_issue_details": {\n      "ssh_cert_issuer_details": {\n        "allowed_users": [\n          "testuser",\n          "session_*"\n        ]\n      }\n    },\n    "secure_remote_access_details": {\n      "enable": true,\n      "use_internal_bastion": true,\n      "ssh_user": "testuser",\n      "host": [\n        "52.201.53.169"\n      ],\n      "is_cli": true,\n      "host_provider_type": "explicit",\n      "gw_cluster_id": 66355\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(s.h2,{id:"certificates",children:"Certificates"}),"\n",(0,a.jsx)(s.h3,{id:"create-a-certificate",children:"Create a Certificate"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'CERT_NAME=kbbgl-gh-dev-tls\nakeyless create-certificate \\\n--name "$CERT_NAME" \\\n--certificate ./certs/kbbgl-gh-dev.crt \\\n--private-key ./certs/kbbgl-gh-dev.key \\\n--profile $AKEYLESS_PROFILE\n'})}),"\n",(0,a.jsx)(s.h3,{id:"get-certificate-and-private-key",children:"Get Certificate and Private Key"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'akeyless get-certificate-value \\\n--name "$CERT_NAME" \\\n--certificate-file-output "/tmp/$CERT_NAME-crt.pem" \\\n--private-key-file-output "/tmp/$CERT_NAME-key.pem" \\\n--profile $AKEYLESS_PROFILE\n'})}),"\n",(0,a.jsx)(s.h3,{id:"get-certificate-public-key",children:"Get Certificate Public Key"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"akeyless get-rsa-public \\\n--name $ENCRYPTION_KEY_NAME \\\n--json \\\n--jq-expression='.ssh' \\\n--profile $AKEYLESS_PROFILE\n"})})]})}function o(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>l});var a=n(96540);const t={},c=a.createContext(t);function i(e){const s=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(c.Provider,{value:s},e.children)}}}]);