"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[97348],{37948:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var n=t(74848),c=t(28453);const r={slug:"certificate-troubleshooting",title:"Troubleshooting Certificates",description:"Troubleshooting Certificates",authors:["kbbgl"],tags:["cybersecurity","certificates","encryption","openssl","cli","k8s"]},s=void 0,a={id:"cybersecurity/Encryption/certificate",title:"Troubleshooting Certificates",description:"Troubleshooting Certificates",source:"@site/docs/cybersecurity/Encryption/certificate.md",sourceDirName:"cybersecurity/Encryption",slug:"/cybersecurity/Encryption/certificate-troubleshooting",permalink:"/docs/cybersecurity/Encryption/certificate-troubleshooting",draft:!1,unlisted:!1,tags:[{inline:!0,label:"cybersecurity",permalink:"/docs/tags/cybersecurity"},{inline:!0,label:"certificates",permalink:"/docs/tags/certificates"},{inline:!0,label:"encryption",permalink:"/docs/tags/encryption"},{inline:!0,label:"openssl",permalink:"/docs/tags/openssl"},{inline:!0,label:"cli",permalink:"/docs/tags/cli"},{inline:!0,label:"k8s",permalink:"/docs/tags/k-8-s"}],version:"current",frontMatter:{slug:"certificate-troubleshooting",title:"Troubleshooting Certificates",description:"Troubleshooting Certificates",authors:["kbbgl"],tags:["cybersecurity","certificates","encryption","openssl","cli","k8s"]},sidebar:"docsSidebar",previous:{title:"Getting Started with the Kernel",permalink:"/docs/os/development/linux_kernel_development/getting-started-kernel"},next:{title:"How to Create a Self-Signed TLS Certificate",permalink:"/docs/cybersecurity/Encryption/how-to-create-self-signed-tls-certificate"}},l={},o=[{value:"Verifying Certificates",id:"verifying-certificates",level:2},{value:"Trusted",id:"trusted",level:3},{value:"Display Certificate Information",id:"display-certificate-information",level:3},{value:"Full Information",id:"full-information",level:3},{value:"Specific Subject and Dates",id:"specific-subject-and-dates",level:3},{value:"Public Keys",id:"public-keys",level:3},{value:"Extract Public Key from Certificate",id:"extract-public-key-from-certificate",level:3},{value:"Displaying Public Key Information",id:"displaying-public-key-information",level:3},{value:"Private Keys",id:"private-keys",level:3},{value:"Displaying Private Key Information",id:"displaying-private-key-information",level:3},{value:"Checking a Private Key",id:"checking-a-private-key",level:3},{value:"Certificate Signing Request (CSR)",id:"certificate-signing-request-csr",level:3},{value:"Reading from STDIN",id:"reading-from-stdin",level:3},{value:"Certificate Expiration",id:"certificate-expiration",level:3},{value:"Adding Self-Signed Certificate to CA Store",id:"adding-self-signed-certificate-to-ca-store",level:2},{value:"Ubuntu",id:"ubuntu",level:3},{value:"RHEL",id:"rhel",level:3},{value:"MacOS Keychain",id:"macos-keychain",level:3},{value:"Certificate Revocation",id:"certificate-revocation",level:2},{value:"CRL (Certificate Revocation List)",id:"crl-certificate-revocation-list",level:3},{value:"OCSP (Online Certificate Status Protocol)",id:"ocsp-online-certificate-status-protocol",level:3}];function d(e){const i={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"The documentation below references a PEM-encoded certificate."}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"CRT_PATH=/tmp/kbbgl-gh-io-tls.crt.pem\n"})}),"\n",(0,n.jsx)(i.h2,{id:"verifying-certificates",children:"Verifying Certificates"}),"\n",(0,n.jsx)(i.h3,{id:"trusted",children:"Trusted"}),"\n",(0,n.jsx)(i.p,{children:"This command checks if a certificate is trusted by a given Certificate Authority (CA):"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl verify -CAfile ca.pem crt.pem\n"})}),"\n",(0,n.jsxs)(i.p,{children:["We can also get the certificate directly and verify it from ",(0,n.jsx)(i.code,{children:"stdin"}),":"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl s_client -connect $REMOTE_SERVER_HOSTNAME:${REMOTE_SERVER_PORT:-443} -showcerts </dev/null 2>/dev/null | \\\nopenssl verify -CAfile /etc/pki/ca-trust/source/anchors/$REMOTE_SERVER_HOSTNAME -\n"})}),"\n",(0,n.jsx)(i.h3,{id:"display-certificate-information",children:"Display Certificate Information"}),"\n",(0,n.jsx)(i.h3,{id:"full-information",children:"Full Information"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl x509 -in /tmp/kgal-localhost-kind-kubeconfig-cluster-cert-auth-data.pem -noout -text\n"})}),"\n",(0,n.jsx)(i.p,{children:"The output will look something like this:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Certificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number: 851...626 (0x763....1c3a)\n        Signature Algorithm: sha256WithRSAEncryption\n        Issuer: CN=kubernetes\n        Validity\n            Not Before: Sep 23 15:36:35 1970 GMT\n            Not After : Sep 21 15:41:35 2070 GMT\n        Subject: CN=kubernetes\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)\n                Modulus:\n                    00:b7:3f...:75\n                Exponent: 65537 (0x10001)\n        X509v3 extensions:\n            X509v3 Key Usage: critical\n                Digital Signature, Key Encipherment, Certificate Sign\n            X509v3 Basic Constraints: critical\n                CA:TRUE\n            X509v3 Subject Key Identifier: \n                F3:A2:...:3C\n            X509v3 Subject Alternative Name: \n                DNS:kubernetes\n    Signature Algorithm: sha256WithRSAEncryption\n    Signature Value:\n        65:91:a9:....b0:9c:48:31\n"})}),"\n",(0,n.jsx)(i.h3,{id:"specific-subject-and-dates",children:"Specific Subject and Dates"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl x509 \\\n-in /tmp/kgal-localhost-kind-kubeconfig-cluster-cert-auth-data.pem \\\n-noout \\\n-subject \\\n-dates\n"})}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"subject=CN=kubernetes\nNot Before: Sep 23 15:36:35 1970 GMT\nNot After : Sep 21 15:41:35 2070 GMT\n"})}),"\n",(0,n.jsx)(i.h3,{id:"public-keys",children:"Public Keys"}),"\n",(0,n.jsx)(i.h3,{id:"extract-public-key-from-certificate",children:"Extract Public Key from Certificate"}),"\n",(0,n.jsx)(i.p,{children:"This extracts the public key from a certificate and displays it in PEM format:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl x509 \\\n-in /tmp/kgal-localhost-kind-kubeconfig-cluster-cert-auth-data.pem \\\n-noout \\\n-pubkey\n\n-----BEGIN PUBLIC KEY-----\nMIIBIj....AB\n-----END PUBLIC KEY-----\n"})}),"\n",(0,n.jsx)(i.h3,{id:"displaying-public-key-information",children:"Displaying Public Key Information"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl x509 \\\n-in /tmp/kgal-localhost-kind-kubeconfig-cluster-public-key-data.pem \\\n-noout \\\n-pubin \\\n-text\n"})}),"\n",(0,n.jsx)(i.h3,{id:"private-keys",children:"Private Keys"}),"\n",(0,n.jsx)(i.h3,{id:"displaying-private-key-information",children:"Displaying Private Key Information"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl pkey -in privatekey.pem -noout -text\n"})}),"\n",(0,n.jsx)(i.h3,{id:"checking-a-private-key",children:"Checking a Private Key"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl rsa -in privatekey.pem -check -noout\n"})}),"\n",(0,n.jsx)(i.h3,{id:"certificate-signing-request-csr",children:"Certificate Signing Request (CSR)"}),"\n",(0,n.jsx)(i.p,{children:"Print the CSR content:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"openssl req -in docs.kbbgl-gh-io.dev.key -text -noout -verify\n"})}),"\n",(0,n.jsx)(i.h3,{id:"reading-from-stdin",children:"Reading from STDIN"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"kubectl get secrets -n default tls-kbbgl-gh-io-dev-crt -o jsonpath='{.data.tls\\.crt}' | base64 -d | openssl x509 -text -noout | grep -A 1 \"Subject Alternative Name\"\n            X509v3 Subject Alternative Name: \n                DNS:kbbgl-gh-io.dev, DNS:*.kbbgl-gh-io.dev\n"})}),"\n",(0,n.jsx)(i.h3,{id:"certificate-expiration",children:"Certificate Expiration"}),"\n",(0,n.jsx)(i.p,{children:"When validating certificates, there could be a couple of other components in the certificate that might be relevant to understand whether a certificate has expired or not."}),"\n",(0,n.jsx)(i.p,{children:"The most basic expiration methods use a static list of certificate IDs:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'# To see it in hex (standard view)\nopenssl x509 -in client.crt -noout -serial\n\n# To see it in decimal\nopenssl x509 -in client.crt -noout -serial -ext serial\n\n# Or more reliably via text output:\nopenssl x509 -in client.crt -noout -text | grep "Serial Number" -A 1\n'})}),"\n",(0,n.jsx)(i.p,{children:'Or the "Not Before" "Not After" attribute:'}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'openssl x509 -in client.crt -noout -text | grep -E "Not Before|After"\n'})}),"\n",(0,n.jsx)(i.h2,{id:"adding-self-signed-certificate-to-ca-store",children:"Adding Self-Signed Certificate to CA Store"}),"\n",(0,n.jsx)(i.h3,{id:"ubuntu",children:"Ubuntu"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"sudo cp $CRT_PATH /usr/local/share/ca-certificates/\nsudo update-ca-certificates\n"})}),"\n",(0,n.jsx)(i.h3,{id:"rhel",children:"RHEL"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"sudo cp $CRT_PATH /etc/pki/ca-trust/source/anchors/kbbgl-gh-io-tls.crt.pem\nsudo update-ca-certificates\nsudo update-ca-trust extract\n"})}),"\n",(0,n.jsx)(i.h3,{id:"macos-keychain",children:"MacOS Keychain"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'sudo security add-trusted-cert -d -r trustRoot -k "/Library/Keychains/System.keychain" $CRT_PATH\n'})}),"\n",(0,n.jsx)(i.h2,{id:"certificate-revocation",children:"Certificate Revocation"}),"\n",(0,n.jsx)(i.h3,{id:"crl-certificate-revocation-list",children:"CRL (Certificate Revocation List)"}),"\n",(0,n.jsx)(i.p,{children:'A Certificate Revocation List is a "blacklist" file published by a Certificate Authority (CA) containing a list of serial numbers of certificates that have been revoked before their scheduled expiration date.'}),"\n",(0,n.jsx)(i.p,{children:"The client downloads this file periodically, parses it, and searches for the serial number of the certificate being presented."}),"\n",(0,n.jsx)(i.p,{children:'A CRL is similar to a printed "Wanted" poster at a post office. You have to check the whole list to see if the person in front of you is on it.'}),"\n",(0,n.jsx)(i.p,{children:"To check if a certificate has a CRL:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'openssl x509 -in client.crt -noout -text | grep -A 4 "CRL Distribution Points"\n'})}),"\n",(0,n.jsx)(i.p,{children:"We can also manually verify a certificate against a CA with CRL:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"# Convert CRL to PEM if needed\nopenssl crl -inform DER -in list.crl -out list.pem\n\n# Verify\nopenssl verify -crl_check -CAfile ca.crt -CRLfile list.pem client.crt\n"})}),"\n",(0,n.jsx)(i.h3,{id:"ocsp-online-certificate-status-protocol",children:"OCSP (Online Certificate Status Protocol)"}),"\n",(0,n.jsx)(i.p,{children:"The Online Certificate Status Protocol is a real-time protocol used to query the status of a specific certificate."}),"\n",(0,n.jsx)(i.p,{children:'Instead of downloading a large list, the client sends a small request to an "OCSP Responder" (a server) asking: "Is certificate #12345 still valid?" The server responds with "Good," "Revoked," or "Unknown."'}),"\n",(0,n.jsx)(i.p,{children:"This is similar to a credit card swipe. The merchant doesn't check a book of stolen cards; they ping the bank instantly to see if this specific card is valid right now."}),"\n",(0,n.jsx)(i.p,{children:"To check and retrieve the OCSP URL:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'openssl x509 -in client.crt -noout -text | grep "OCSP - URI"\n'})})]})}function h(e={}){const{wrapper:i}={...(0,c.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>s,x:()=>a});var n=t(96540);const c={},r=n.createContext(c);function s(e){const i=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),n.createElement(r.Provider,{value:i},e.children)}}}]);