"use strict";(self.webpackChunkkgkb=self.webpackChunkkgkb||[]).push([[81060],{13592:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var t=s(74848),i=s(28453);const o={},r="SELinux",c={id:"os/UNIX/Security/SELinux",title:"SELinux",description:"Developed by the NSA.",source:"@site/docs/os/UNIX/Security/SELinux.md",sourceDirName:"os/UNIX/Security",slug:"/os/UNIX/Security/SELinux",permalink:"/docs/os/UNIX/Security/SELinux",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"AppArmor",permalink:"/docs/os/UNIX/Security/AppArmor"},next:{title:"Linux Security Modules",permalink:"/docs/os/UNIX/Security/linux_security_modules"}},l={},d=[{value:"Policies",id:"policies",level:2},{value:"Contexts",id:"contexts",level:2},{value:"Context Inheritence",id:"context-inheritence",level:3},{value:"Monitoring Access",id:"monitoring-access",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"selinux",children:"SELinux"})}),"\n",(0,t.jsx)(n.p,{children:"Developed by the NSA."}),"\n",(0,t.jsx)(n.p,{children:"It's a set of security rules that are used to determine which processes can access which files, directories, ports and other items in the system."}),"\n",(0,t.jsx)(n.p,{children:"It works with 3 conceptual quantities:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Contexts"}),": labels to files, processes and ports."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rules"}),": describe access control in terms of context, process, files, ports, users, etc."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Policies"}),": Set of rules that describe what system-wide access control decisions should be made by SELinux."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"It can run in 3 modes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Enforcing"}),": SELinux is operating, access is denied according to policy. All violations are audited and logged."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Permissive"}),": SELinux is enabled but only audits and warns about operations that would be denied in enforcing mode."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Disabled"}),": SELinux is disabled, no policies enforced."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Modes are written in ",(0,t.jsx)(n.code,{children:"/etc/selinux/config"})," or ",(0,t.jsx)(n.code,{children:"/etc/sysconfig/selinux"}),"/",(0,t.jsx)(n.code,{children:"/etc/default/selinux"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"To check status of current mode and policy:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sestatus\n"})}),"\n",(0,t.jsx)(n.p,{children:"To set or examine current mode:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"getenforce\n\nsudo setenforce Permissive\n"})}),"\n",(0,t.jsx)(n.p,{children:"To disable SELinux:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# /etc/selinux/config\n# set to disabled\nSELINUX=disabled\n"})}),"\n",(0,t.jsx)(n.h2,{id:"policies",children:"Policies"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"/etc/sysconfig/selinux"})," or ",(0,t.jsx)(n.code,{children:"/etc/default/selinux"})," sets the policy."]}),"\n",(0,t.jsx)(n.p,{children:"Multiple policies are allowed but only can be active."}),"\n",(0,t.jsx)(n.p,{children:"Each policy has it's own files under:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/etc/selinux/[SELINUXTYPE]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Common policies:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"targeted"}),": The default policy in which SELinux is more restricted to targeted processes. User processes and init processes are not targeted. SELinux enforces memory restrictions for all processes, which reduces the vulnerability to buffer overflow attacks."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"minimum"}),": A modification of the targeted policy where only selected processes are protected."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"MLS"}),": The Multi-Level Security policy is much more restrictive; all processes are placed in fine-grained security domains with particular policies."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"contexts",children:"Contexts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"User"}),"\n",(0,t.jsx)(n.li,{children:"Role"}),"\n",(0,t.jsxs)(n.li,{children:["Type (most common) - convention for name is ",(0,t.jsx)(n.code,{children:"_t"}),", e.g ",(0,t.jsx)(n.code,{children:"kernel_t"})]}),"\n",(0,t.jsx)(n.li,{children:"Level"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To see context:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ls -Z\nps auZ\n"})}),"\n",(0,t.jsx)(n.p,{children:"To change context:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"chcon -t etc_t $somefile\nchcon --reference somefile so\n"})}),"\n",(0,t.jsx)(n.h3,{id:"context-inheritence",children:"Context Inheritence"}),"\n",(0,t.jsx)(n.p,{children:"Newly created files inherit the context from their parent directory, but when moving files, it is the context of the source directory which may be preserved, which can cause problems."}),"\n",(0,t.jsx)(n.p,{children:"To reset file contexts based on parent:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"restorecon\n"})}),"\n",(0,t.jsx)(n.p,{children:"To configure the default context for new directories:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# make the change\nsemanage fcontext -a -t httpd_sys_content_t /virtualHosts\n\n# apply it\nrestorecon -Rfv /virtualHosts\n"})}),"\n",(0,t.jsx)(n.h2,{id:"monitoring-access",children:"Monitoring Access"}),"\n",(0,t.jsx)(n.p,{children:"SELinux comes with a set of tools that collect issues at run time, log these issues and propose solutions to prevent same issues from happening again. These utilities are provided by the setroubleshoot-server package. Here is an example of their use:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"[root@rhel7 ~]# echo 'File created at /root' > rootfile\n[root@rhel7 ~]# mv rootfile /var/www/html/\n[root@rhel7 ~]# wget -O - localhost/rootfile\n--2014-11-21 13:42:04-- http://localhost/rootfile\nResolving localhost (localhost)... ::1, 127.0.0.1\nConnecting to localhost (localhost)|::1|:80... connected.\nHTTP request sent, awaiting response... 403 Forbidden\n2014-11-21 13:42:04 ERROR 403: Forbidden.\n\n[root@rhel7 ~]# tail /var/log/messages\nNov 21 13:42:04 rhel7 setroubleshoot: Plugin Exception restorecon\nNov 21 13:42:04 rhel7 setroubleshoot: SELinux is preventing /usr/sbin/httpd from getattr access on the file .\n....\nNov 21 13:42:04 rhel7 python: SELinux is preventing /usr/sbin/httpd from getattr access on the file .\n....\nDo allow this access for now by executing\n# grep httpd /var/log/audit/audit.log | audit2allow -M mypol\n# semodule -i mypol.pp\n\nAdditional Information:\nSource Context system_u:system_r:httpd_t:s0\nTarget Context unconfined_u:object_r:admin_home_t:s0\nTarget Objects [ file ]\nSource httpd\nSource Path /usr/sbin/httpd\n....\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var t=s(96540);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);