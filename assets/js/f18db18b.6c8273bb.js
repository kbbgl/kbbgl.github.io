"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[14449],{40999:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>i});var t=n(74848),a=n(28453);const l={title:"How to Set Up Chaos Mesh on Kubernetes using Helm",slug:"how-to-setup-chaos-mesh-k8s-helm",app2or:"kgal-akl",tags:["devops","chaos","helm","kubernetes","k8s","testing"]},o=void 0,c={id:"software/chaos/mesh",title:"How to Set Up Chaos Mesh on Kubernetes using Helm",description:"Install",source:"@site/docs/software/chaos/mesh.md",sourceDirName:"software/chaos",slug:"/software/chaos/how-to-setup-chaos-mesh-k8s-helm",permalink:"/docs/software/chaos/how-to-setup-chaos-mesh-k8s-helm",draft:!1,unlisted:!1,tags:[{inline:!0,label:"devops",permalink:"/docs/tags/devops"},{inline:!0,label:"chaos",permalink:"/docs/tags/chaos"},{inline:!0,label:"helm",permalink:"/docs/tags/helm"},{inline:!0,label:"kubernetes",permalink:"/docs/tags/kubernetes"},{inline:!0,label:"k8s",permalink:"/docs/tags/k-8-s"},{inline:!0,label:"testing",permalink:"/docs/tags/testing"}],version:"current",frontMatter:{title:"How to Set Up Chaos Mesh on Kubernetes using Helm",slug:"how-to-setup-chaos-mesh-k8s-helm",app2or:"kgal-akl",tags:["devops","chaos","helm","kubernetes","k8s","testing"]},sidebar:"docsSidebar",previous:{title:"How to Add Network Flakiness",permalink:"/docs/software/chaos/add-flaky-network"},next:{title:"How to Set Up GitLab Self-Hosted Runner",permalink:"/docs/software/cicd/how-to-setup-gitlab-self-hosted-runner"}},r={},i=[{value:"Install",id:"install",level:2},{value:"Run DNS Fault Experiment",id:"run-dns-fault-experiment",level:2},{value:"Check Experiment Status",id:"check-experiment-status",level:2},{value:"Stop Experiment",id:"stop-experiment",level:2}];function h(e){const s={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"install",children:"Install"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"helm repo add chaos-mesh https://charts.chaos-mesh.org\nkubectl create ns chaos-mesh\n"})}),"\n",(0,t.jsx)(s.p,{children:"When using k3s, we deploy it using:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"helm install chaos-mesh chaos-mesh/chaos-mesh \\\n\t--namespace chaos-mesh \\\n\t--set chaosDaemon.runtime=containerd \\\n\t--set chaosDaemon.socketPath=/run/k3s/containerd/containerd.sock \\\n\t--set controllerManager.leaderElection.enabled=false \\\n\t--set dashboard.securityMode=false \\\n\t--version 2.8.0\n"})}),"\n",(0,t.jsxs)(s.p,{children:["For other container runtimes, check out ",(0,t.jsx)(s.a,{href:"https://chaos-mesh.org/docs/production-installation-using-helm/#step-4-install-chaos-mesh-in-different-environments",children:"this"}),". To check what runtime is currently set up:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl get node kgal-azure-dev \\\n\t--output yaml | \\\n\tyq '.status.nodeInfo.containerRuntimeVersion'\ncontainerd://2.0.5-k3s1.32\n"})}),"\n",(0,t.jsx)(s.h2,{id:"run-dns-fault-experiment",children:"Run DNS Fault Experiment"}),"\n",(0,t.jsxs)(s.p,{children:["Define an experiment. Make sure to modify the namespaces and the target pods in ",(0,t.jsx)(s.code,{children:".spec.selector.namespaces"})," and `.spec.selector.pods.$NAMESPACE[0].$TARGET_POD_NAME:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"kind: DNSChaos\napiVersion: chaos-mesh.org/v1alpha1\nmetadata:\n  namespace: kbbgl-staging\n  name: saas-outage\nspec:\n  action: error\n  selector:\n\tnamespaces:\n\t- kbbgl-staging\n\tpods:\n\t  kbbgl-staging:\n\t  - app-svc-app-6b98bd4645-s77qp\n\tmode: all\n\tpatterns:\n\t- app1.kbbgl.svc.local\n\t- app1-ro.kbbgl.svc.local\n\t- app2.kbbgl.svc.local\n\t- app2-ro.kbbgl.svc.local\n\t- app3.kbbgl.svc.local\n\t- app3-ro.kbbgl.svc.local\n\t- app4.kbbgl.svc.local\n\t- app5.kbbgl.svc.local\n\t- ms1.kbbgl.svc.local\n\t- ms1-ro.kbbgl.svc.local\n\t- ms2.kbbgl.svc.local\n\t- ms2-ro.kbbgl.svc.local\n\t- ms3.kbbgl.svc.local\n\t- ms3-ro.kbbgl.svc.local\n\t- ms4.kbbgl.svc.local\n\t- ms4-ro.kbbgl.svc.local\n\t- api.kbbgl.svc.local\n\t- rest.kbbgl.svc.local\n\t- log.kbbgl.svc.local\n"})}),"\n",(0,t.jsx)(s.p,{children:"Then apply it:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f dns-fault-kbbgl-staging.yaml\n"})}),"\n",(0,t.jsx)(s.h2,{id:"check-experiment-status",children:"Check Experiment Status"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl get dnschaos -n kbbgl-staging\n\nNAME STATUS AGE \nsaas-outage AllInjected 15s\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl describe dnschaos saas-outage -n kbbgl-staging\n"})}),"\n",(0,t.jsx)(s.h2,{id:"stop-experiment",children:"Stop Experiment"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl delete -f dns-fault-kbbgl-staging.yaml\n"})})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>c});var t=n(96540);const a={},l=t.createContext(a);function o(e){const s=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(l.Provider,{value:s},e.children)}}}]);