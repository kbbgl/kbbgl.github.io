"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[27926],{48277:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>o});var s=n(74848),r=n(28453);const a={slug:"how-to-create-self-signed-tls-certificate",title:"How to Create a Self-Signed TLS Certificate",description:"How to Create a Self-Signed TLS Certificate",authors:["kgal-akl"],tags:["cybersecurity","certificates","encryption","openssl","cli"]},c=void 0,i={id:"cybersecurity/Encryption/create_tls_certificate",title:"How to Create a Self-Signed TLS Certificate",description:"How to Create a Self-Signed TLS Certificate",source:"@site/docs/cybersecurity/Encryption/create_tls_certificate.md",sourceDirName:"cybersecurity/Encryption",slug:"/cybersecurity/Encryption/how-to-create-self-signed-tls-certificate",permalink:"/docs/cybersecurity/Encryption/how-to-create-self-signed-tls-certificate",draft:!1,unlisted:!1,tags:[{inline:!0,label:"cybersecurity",permalink:"/docs/tags/cybersecurity"},{inline:!0,label:"certificates",permalink:"/docs/tags/certificates"},{inline:!0,label:"encryption",permalink:"/docs/tags/encryption"},{inline:!0,label:"openssl",permalink:"/docs/tags/openssl"},{inline:!0,label:"cli",permalink:"/docs/tags/cli"}],version:"current",frontMatter:{slug:"how-to-create-self-signed-tls-certificate",title:"How to Create a Self-Signed TLS Certificate",description:"How to Create a Self-Signed TLS Certificate",authors:["kgal-akl"],tags:["cybersecurity","certificates","encryption","openssl","cli"]},sidebar:"docsSidebar",previous:{title:"Troubleshooting Certificates",permalink:"/docs/cybersecurity/Encryption/certificate-troubleshooting"},next:{title:"How SSL Works",permalink:"/docs/cybersecurity/Encryption/how-ssl-works"}},l={},o=[{value:"Generate Server Key and CSR",id:"generate-server-key-and-csr",level:2},{value:"Create Kubernetes TLS Secret",id:"create-kubernetes-tls-secret",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"In some cases we'd want to set up TLS on a webserver for testing purposes."}),"\n",(0,s.jsxs)(t.p,{children:["In Kubernetes we can utilize the ",(0,s.jsx)(t.a,{href:"/docs/software/containerization/k8s/how-to-deploy-cert-manager-k8s",children:"CertManager"})," to create it for us."]}),"\n",(0,s.jsxs)(t.p,{children:["This tutorial explains how to create one manually using ",(0,s.jsx)(t.code,{children:"openssl"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Let's say we have an EKS cluster named ",(0,s.jsx)(t.code,{children:"kgal-eks.dev"})," and we'd like to create a new Kubernetes ",(0,s.jsx)(t.code,{children:"Ingress"})," (e.g. ",(0,s.jsx)(t.code,{children:"IngressClass"})," is installed ",(0,s.jsx)(t.code,{children:"alb"}),") that would terminate TLS for the host ",(0,s.jsx)(t.code,{children:"app.kgal-eks.dev"}),". The ",(0,s.jsx)(t.code,{children:"Ingress"})," will use a Kubernetes ",(0,s.jsx)(t.code,{children:"Secret"})," to populate the TLS server certificate and private key."]}),"\n",(0,s.jsx)(t.h2,{id:"generate-server-key-and-csr",children:"Generate Server Key and CSR"}),"\n",(0,s.jsx)(t.p,{children:"Create a server configuration file:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"[req]\ndistinguished_name = req_distinguished_name\nreq_extensions = v3_req\nprompt = no\n\n[req_distinguished_name]\nCN = app.kgal-eks.dev\n\n[v3_req]\nkeyUsage = keyEncipherment, dataEncipherment, digitalSignature\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = app.kgal-eks.dev\n"})}),"\n",(0,s.jsx)(t.p,{children:"Then create the server key and CSR:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"openssl genrsa -out app.kgal-eks.dev.key.pem 2048\nopenssl req -new -key app.kgal-eks.dev.key.pem -out app.kgal-eks.dev.csr -config app-kgal-eks-dev.cnf\n"})}),"\n",(0,s.jsx)(t.p,{children:"and sign it with a Certificate Authority (CA):"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"openssl x509 -req -in app.kgal-eks.dev.csr \\\n  -CA ca.pem -CAkey ca.key.pem -CAcreateserial \\\n  -out app.kgal-eks.dev.crt.pem -days 825 \\\n  -extensions v3_req -extfile app-kgal-eks-dev.cnf\n"})}),"\n",(0,s.jsx)(t.h2,{id:"create-kubernetes-tls-secret",children:"Create Kubernetes TLS Secret"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"Ingress"})," expects the ",(0,s.jsx)(t.code,{children:"tls.crt"})," to be the server certificate first and then the CA so clients can verify the chain:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cat app.kgal-eks.dev.crt.pem ca.pem > app.kgal-eks.dev.chain.pem\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kubectl create secret tls tls-kgal-eks-dev-crt \\\n--cert=app.kgal-eks.dev.chain.pem \\\n--key=app.kgal-eks.dev.key.pem\n"})})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>i});var s=n(96540);const r={},a=s.createContext(r);function c(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);