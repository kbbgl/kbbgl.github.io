"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[80580],{23556:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var t=s(74848),r=s(28453);const o={},a=void 0,i={id:"software/containerization/k8s/install_config/upgrade_cluster",title:"upgrade_cluster",description:"Upgrade Cluster",source:"@site/docs/software/containerization/k8s/install_config/upgrade_cluster.md",sourceDirName:"software/containerization/k8s/install_config",slug:"/software/containerization/k8s/install_config/upgrade_cluster",permalink:"/docs/software/containerization/k8s/install_config/upgrade_cluster",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"tools",permalink:"/docs/software/containerization/k8s/install_config/tools"},next:{title:"How to Add Custom Host to K3S",permalink:"/docs/software/containerization/k8s/how-to-add-custom-host-k3s"}},l={},c=[{value:"Upgrade Cluster",id:"upgrade-cluster",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"upgrade-cluster",children:"Upgrade Cluster"}),"\n",(0,t.jsxs)(n.p,{children:["If the cluster was built using ",(0,t.jsx)(n.code,{children:"kubeadm"}),", ",(0,t.jsx)(n.code,{children:"kubeadm upgrade"})," can be used to upgrade a cluster."]}),"\n",(0,t.jsx)(n.p,{children:"To compare the installed version with the latest and if it's posssible to upgrade:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm upgrade plan\n"})}),"\n",(0,t.jsx)(n.p,{children:"To upgrade first control plane to specified version:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm apply\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To show the differences applied during the upgrade (similar to ",(0,t.jsx)(n.code,{children:"kubectl apply --dry-run"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm diff\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This allows for updating the local ",(0,t.jsx)(n.code,{children:"kubelet"})," configuration on worker nodes, or the control planes of other master nodes if there is more than one. Also, it will access a phase command to step through the upgrade process:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm node\n"})}),"\n",(0,t.jsx)(n.p,{children:"General upgrade process:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Update the software"}),"\n",(0,t.jsx)(n.li,{children:"Check the software version"}),"\n",(0,t.jsx)(n.li,{children:"Drain the control plane"}),"\n",(0,t.jsx)(n.li,{children:"View the planned upgrade"}),"\n",(0,t.jsx)(n.li,{children:"Apply the upgrade"}),"\n",(0,t.jsx)(n.li,{children:"Uncordon the control plane to allow pods to be scheduled."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/",children:"Full details"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>i});var t=s(96540);const r={},o=t.createContext(r);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);