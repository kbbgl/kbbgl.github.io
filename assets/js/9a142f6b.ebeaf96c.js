"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[55894],{33243:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>o});var n=a(74848),s=a(28453);const l={slug:"hashicorp-vault-cheatsheet",title:"HashiCorp Vault Cheat Sheet",authors:["kgal-akl"],tags:["secrets","vault","hashicorp","cheatsheet","cli"]},i=void 0,r={id:"software/infrastructure/hashicorp_vault",title:"HashiCorp Vault Cheat Sheet",description:"Initialize Vault",source:"@site/docs/software/infrastructure/hashicorp_vault.md",sourceDirName:"software/infrastructure",slug:"/software/infrastructure/hashicorp-vault-cheatsheet",permalink:"/docs/software/infrastructure/hashicorp-vault-cheatsheet",draft:!1,unlisted:!1,tags:[{inline:!0,label:"secrets",permalink:"/docs/tags/secrets"},{inline:!0,label:"vault",permalink:"/docs/tags/vault"},{inline:!0,label:"hashicorp",permalink:"/docs/tags/hashicorp"},{inline:!0,label:"cheatsheet",permalink:"/docs/tags/cheatsheet"},{inline:!0,label:"cli",permalink:"/docs/tags/cli"}],version:"current",frontMatter:{slug:"hashicorp-vault-cheatsheet",title:"HashiCorp Vault Cheat Sheet",authors:["kgal-akl"],tags:["secrets","vault","hashicorp","cheatsheet","cli"]},sidebar:"docsSidebar",previous:{title:"Redis Database Cheatsheet",permalink:"/docs/software/database/redis-cheatsheet"},next:{title:"Query with Regex, Sort, Limit",permalink:"/docs/software/infrastructure/mongodb/mongodb-query-sort-limit-regex"}},c={},o=[{value:"Initialize Vault",id:"initialize-vault",level:2},{value:"Unseal Vault",id:"unseal-vault",level:2},{value:"Log Into Vault",id:"log-into-vault",level:2},{value:"Enable Key/Value Store",id:"enable-keyvalue-store",level:2},{value:"Add Secrets to Key/Value Store",id:"add-secrets-to-keyvalue-store",level:2},{value:"Create Policy",id:"create-policy",level:2},{value:"Create Token",id:"create-token",level:2},{value:"Accessing Vault UI",id:"accessing-vault-ui",level:2}];function h(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"initialize-vault",children:"Initialize Vault"}),"\n",(0,n.jsx)(t.p,{children:"After the HashiCorp Vault service deployment is complete, we need to initialize it:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"vault operator init \\\n\t-key-shares=1 \\\n\t-key-threshold=1 \\\n\t-format=json > vault-keys.json\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The resulting ",(0,n.jsx)(t.code,{children:"vault-keys.json"})," looks like:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-json",children:'{\n\t"unseal_keys_b64": ["[REDACTED]+fQpVFVHQdYi9woCL1TYLY="],\n\t"unseal_keys_hex": ["7131540f02[REDACTED]"],\n\t"unseal_shares": 1,\n\t"unseal_threshold": 1,\n\t"recovery_keys_b64": [],\n\t"recovery_keys_hex": [],\n\t"recovery_keys_shares": 0,\n\t"recovery_keys_threshold": 0,\n\t"root_token": "hvs.[REDACTED]"\n}\n'})}),"\n",(0,n.jsx)(t.h2,{id:"unseal-vault",children:"Unseal Vault"}),"\n",(0,n.jsx)(t.p,{children:"To do anything (e.g. create key-vault store, create policies) with the vault, we need to first unseal it"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"UNSEAL_KEY=$(jq -r '.unseal_keys_b64[0]' vault-keys.json)\n\nvault operator unseal $UNSEAL_KEY\n"})}),"\n",(0,n.jsx)(t.p,{children:"We can confirm it's unsealed:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:" vault status\nKey             Value\n---             -----\nSeal Type       shamir\nInitialized     true\nSealed          false\n"})}),"\n",(0,n.jsx)(t.h2,{id:"log-into-vault",children:"Log Into Vault"}),"\n",(0,n.jsx)(t.p,{children:"We can use the root token to log in and manage the vault:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ROOT_TOKEN=$(jq -r '.root_token' vault-keys.json)\n\nvault login $ROOT_TOKEN\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Once we're logged in, we can ",(0,n.jsx)(t.a,{href:"#enable-keyvalue-store",children:"Enable Key/Value Store"}),", ",(0,n.jsx)(t.a,{href:"#add-secrets-to-keyvalue-store",children:"Add Secrets to Key/Value Store"}),", ",(0,n.jsx)(t.a,{href:"#create-token",children:"Create Token"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"enable-keyvalue-store",children:"Enable Key/Value Store"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"vault secrets enable -version=2 kv\n"})}),"\n",(0,n.jsx)(t.h2,{id:"add-secrets-to-keyvalue-store",children:"Add Secrets to Key/Value Store"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"vault kv put myservice/api api_key=t-1234 api_secret=null endpoint=https://api.staging.myservice.dev\n\nvault kv put myservice/database username=admin password=securepassword123 host=staging.myservice.dev port=5432\n\nvault kv list myservice\nKeys\n----\napi\ndatabase\n"})}),"\n",(0,n.jsx)(t.h2,{id:"create-policy",children:"Create Policy"}),"\n",(0,n.jsx)(t.p,{children:"We can use a policy to define what capabilities users have for certain vault paths. Here's an example:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-hcl",children:'# Allow reading all secrets\npath "myservice/*" {\n  capabilities = ["read", "list"]\n}\n\n# Allow reading auth methods\npath "auth/*" {\n  capabilities = ["read", "list"]\n}\n\n# Allow reading sys/mounts to see enabled secrets engines\npath "sys/mounts" {\n  capabilities = ["read"]\n}\n'})}),"\n",(0,n.jsx)(t.p,{children:"To create the policy:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"vault policy write myservice-migration-policy migration.hcl\n"})}),"\n",(0,n.jsx)(t.h2,{id:"create-token",children:"Create Token"}),"\n",(0,n.jsx)(t.p,{children:"Once we have a policy, we can create a token that will have the capabilities defined in the policy:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'vault token create \\\n\t-policy=myservice-migration-policy \\\n\t-ttl=24h \\\n\t-display-name="myservice-migration-token"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'Key                  Value\n---                  -----\ntoken                hvs.[REDACTED]\ntoken_accessor       [REDACTED]\ntoken_duration       768h\ntoken_renewable      true\ntoken_policies       ["default" "myservice-migration-policy"]\nidentity_policies    []\npolicies             ["default" "myservice-migration-policy"]\n'})}),"\n",(0,n.jsx)(t.h2,{id:"accessing-vault-ui",children:"Accessing Vault UI"}),"\n",(0,n.jsxs)(t.p,{children:["When the vault is deployed in Kubernetes, we can access the vault UI by navigating to ",(0,n.jsx)(t.a,{href:"http://localhost:8200",children:"http://localhost:8200"})," after running:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"VAULT_POD=$(kubectl get pods -n vault -l app.kubernetes.io/name=vault -o jsonpath='{.items[0].metadata.name}')\nkubectl port-forward $VAULT_POD 8200:8200 -n vault\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Log in with the token created in ",(0,n.jsx)(t.a,{href:"#create-token",children:"Create Token"}),"."]})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},28453:(e,t,a)=>{a.d(t,{R:()=>i,x:()=>r});var n=a(96540);const s={},l=n.createContext(s);function i(e){const t=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(l.Provider,{value:t},e.children)}}}]);