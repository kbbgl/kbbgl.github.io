"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[42948],{99147:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var c=i(74848),s=i(28453);const t={title:"Kubeconfig (kubectl configuration)",slug:"kubeconfig",tags:["devops","k8s","kubernetes","kubectl","kubeconfig","security"],authors:["kbbgl"]},o="Kubeconfig (kubectl configuration)",l={id:"software/containerization/k8s/kubeconfig",title:"Kubeconfig (kubectl configuration)",description:"A kubeconfig is a YAML file that tells kubectl (and other Kubernetes clients) which cluster to talk to and how to authenticate. By default, kubectl reads:",source:"@site/docs/software/containerization/k8s/kubeconfig.md",sourceDirName:"software/containerization/k8s",slug:"/software/containerization/k8s/kubeconfig",permalink:"/docs/software/containerization/k8s/kubeconfig",draft:!1,unlisted:!1,tags:[{inline:!0,label:"devops",permalink:"/docs/tags/devops"},{inline:!0,label:"k8s",permalink:"/docs/tags/k-8-s"},{inline:!0,label:"kubernetes",permalink:"/docs/tags/kubernetes"},{inline:!0,label:"kubectl",permalink:"/docs/tags/kubectl"},{inline:!0,label:"kubeconfig",permalink:"/docs/tags/kubeconfig"},{inline:!0,label:"security",permalink:"/docs/tags/security"}],version:"current",frontMatter:{title:"Kubeconfig (kubectl configuration)",slug:"kubeconfig",tags:["devops","k8s","kubernetes","kubectl","kubeconfig","security"],authors:["kbbgl"]},sidebar:"docsSidebar",previous:{title:"Managing Local Kubernetes Clusters using Kubernetes in Docker (kind)",permalink:"/docs/software/containerization/k8s/managing-local-k8s-clusters-with-kind"},next:{title:"Cluster_Start_Sequence",permalink:"/docs/software/containerization/k8s/logs_troubleshooting/Cluster_Start_Sequence"}},r={},a=[{value:"What&#39;s inside a kubeconfig",id:"whats-inside-a-kubeconfig",level:2},{value:"Common workflows",id:"common-workflows",level:2},{value:"List contexts and switch clusters",id:"list-contexts-and-switch-clusters",level:3},{value:"Use a specific kubeconfig (without changing your default)",id:"use-a-specific-kubeconfig-without-changing-your-default",level:3},{value:"Precedence (what wins)",id:"precedence-what-wins",level:3},{value:"Merge multiple kubeconfig files into one",id:"merge-multiple-kubeconfig-files-into-one",level:3},{value:"Minify (show only the active context)",id:"minify-show-only-the-active-context",level:3},{value:"Remove a stale context",id:"remove-a-stale-context",level:3},{value:"Creating a least-privilege kubeconfig (concept)",id:"creating-a-least-privilege-kubeconfig-concept",level:2},{value:"Security best practices",id:"security-best-practices",level:2},{value:"Sources",id:"sources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"kubeconfig-kubectl-configuration",children:"Kubeconfig (kubectl configuration)"})}),"\n",(0,c.jsxs)(n.p,{children:["A ",(0,c.jsx)(n.strong,{children:"kubeconfig"})," is a YAML file that tells ",(0,c.jsx)(n.code,{children:"kubectl"})," (and other Kubernetes clients) ",(0,c.jsx)(n.strong,{children:"which cluster to talk to"})," and ",(0,c.jsx)(n.strong,{children:"how to authenticate"}),". By default, ",(0,c.jsx)(n.code,{children:"kubectl"})," reads:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"~/.kube/config"})}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"whats-inside-a-kubeconfig",children:"What's inside a kubeconfig"}),"\n",(0,c.jsx)(n.p,{children:"A kubeconfig typically contains:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"clusters"}),": API server ",(0,c.jsx)(n.code,{children:"server:"})," endpoint + the cluster CA (",(0,c.jsx)(n.code,{children:"certificate-authority-data"})," or ",(0,c.jsx)(n.code,{children:"certificate-authority"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"users"}),": how to authenticate (commonly a ",(0,c.jsx)(n.code,{children:"token"}),", client cert/key, or an ",(0,c.jsx)(n.code,{children:"exec"})," auth plugin)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"contexts"}),": a named binding of ",(0,c.jsx)(n.strong,{children:"(cluster + user + optional namespace)"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"current-context"}),": which context ",(0,c.jsx)(n.code,{children:"kubectl"})," uses by default"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Minimal example shape:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Config\nclusters:\n- name: my-cluster\n  cluster:\n    server: https://my-k8s-cluster.example.com\n    certificate-authority-data: <base64-ca-cert>\nusers:\n- name: my-user\n  user:\n    token: <bearer-token>\ncontexts:\n- name: my-context\n  context:\n    cluster: my-cluster\n    user: my-user\ncurrent-context: my-context\n"})}),"\n",(0,c.jsx)(n.h2,{id:"common-workflows",children:"Common workflows"}),"\n",(0,c.jsx)(n.h3,{id:"list-contexts-and-switch-clusters",children:"List contexts and switch clusters"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl config get-contexts -o name\nkubectl config use-context my-context\n"})}),"\n",(0,c.jsx)(n.p,{children:"Quick sanity check:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),"\n",(0,c.jsx)(n.h3,{id:"use-a-specific-kubeconfig-without-changing-your-default",children:"Use a specific kubeconfig (without changing your default)"}),"\n",(0,c.jsx)(n.p,{children:"Use-case: CI jobs, one-off access to prod, testing a new config you were given."}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Inline for a single command"}),":"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'kubectl get nodes --kubeconfig "$HOME/.kube/dev_cluster_config"\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Via environment variable"}),":"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'export KUBECONFIG="$HOME/.kube/dev_cluster_config"\nkubectl get nodes\n'})}),"\n",(0,c.jsx)(n.h3,{id:"precedence-what-wins",children:"Precedence (what wins)"}),"\n",(0,c.jsx)(n.p,{children:"In practice, these commonly override each other in this order:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"--kubeconfig ..."})," on the command line"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"KUBECONFIG=..."})," environment variable"]}),"\n",(0,c.jsxs)(n.li,{children:["default ",(0,c.jsx)(n.code,{children:"~/.kube/config"})," (and its ",(0,c.jsx)(n.code,{children:"current-context"}),")"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"merge-multiple-kubeconfig-files-into-one",children:"Merge multiple kubeconfig files into one"}),"\n",(0,c.jsxs)(n.p,{children:["Use-case: you have separate ",(0,c.jsx)(n.code,{children:"kubeconfig"}),"s for dev/test/prod, but want a single ",(0,c.jsx)(n.code,{children:"~/.kube/config"})," with multiple contexts."]}),"\n",(0,c.jsxs)(n.p,{children:["From ",(0,c.jsx)(n.code,{children:"~/.kube"})," (or using full paths), you can merge and flatten:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'KUBECONFIG=config:dev_config:test_config kubectl config view --merge --flatten > config.new\nmv "$HOME/.kube/config" "$HOME/.kube/config.old"\nmv "$HOME/.kube/config.new" "$HOME/.kube/config"\n'})}),"\n",(0,c.jsx)(n.p,{children:"Verify:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl config get-contexts -o name\n"})}),"\n",(0,c.jsx)(n.h3,{id:"minify-show-only-the-active-context",children:"Minify (show only the active context)"}),"\n",(0,c.jsxs)(n.p,{children:["Use-case: quickly inspect exactly what ",(0,c.jsx)(n.code,{children:"kubectl"})," will use right now."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl config view --minify\n"})}),"\n",(0,c.jsx)(n.h3,{id:"remove-a-stale-context",children:"Remove a stale context"}),"\n",(0,c.jsx)(n.p,{children:"Use-case: cluster was deleted, but the context still exists locally."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl config get-contexts -o name\nkubectl config delete-context my-old-context\n"})}),"\n",(0,c.jsx)(n.h2,{id:"creating-a-least-privilege-kubeconfig-concept",children:"Creating a least-privilege kubeconfig (concept)"}),"\n",(0,c.jsxs)(n.p,{children:["Common pattern: create a dedicated identity (often a ",(0,c.jsx)(n.code,{children:"ServiceAccount"}),") with RBAC permissions restricted to what\u2019s needed (namespace-scoped when possible), then generate a ",(0,c.jsx)(n.code,{children:"kubeconfig"})," that authenticates as that identity."]}),"\n",(0,c.jsx)(n.p,{children:"Typical building blocks:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"ServiceAccount"})," in a namespace"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Role/ClusterRole"})," granting specific verbs/resources"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"RoleBinding/ClusterRoleBinding"})," binding the ",(0,c.jsx)(n.code,{children:"ServiceAccount"})," to the role"]}),"\n",(0,c.jsxs)(n.li,{children:["A ",(0,c.jsx)(n.strong,{children:"token"})," for the ",(0,c.jsx)(n.code,{children:"ServiceAccount"})," (Kubernetes v1.24+ commonly uses an explicit token ",(0,c.jsx)(n.code,{children:"Secret"})," or projected tokens)"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Once you have the cluster endpoint, CA data, and token, you can assemble a ",(0,c.jsx)(n.code,{children:"kubeconfig"})," like the minimal example above."]}),"\n",(0,c.jsx)(n.h2,{id:"security-best-practices",children:"Security best practices"}),"\n",(0,c.jsxs)(n.p,{children:["Kubeconfigs often contain ",(0,c.jsx)(n.strong,{children:"tokens and/or client keys"}),". Treat them like credentials."]}),"\n",(0,c.jsx)(n.p,{children:"Lock down permissions:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'chmod 600 "$HOME/.kube/config"\nchmod 700 "$HOME/.kube"\n'})}),"\n",(0,c.jsx)(n.p,{children:"Avoid accidental commits:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Keep ",(0,c.jsx)(n.code,{children:"kubeconfigs"})," out of Git repos"]}),"\n",(0,c.jsxs)(n.li,{children:["Add patterns to ignore files named like ",(0,c.jsx)(n.code,{children:"kubeconfig*"})," (either per-repo ",(0,c.jsx)(n.code,{children:".gitignore"})," or your global gitignore)"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"sources",children:"Sources"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://devopscube.com/kubernetes-kubeconfig-file/",children:"Kubeconfig File Explained (Examples, Usage and Configuration) (DevOpsCube)"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var c=i(96540);const s={},t=c.createContext(s);function o(e){const n=c.useContext(t);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),c.createElement(t.Provider,{value:n},e.children)}}}]);