"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[79981],{1891:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>p});var i=a(74848),r=a(28453);const s={slug:"managing-azure-container-app",title:"Managing Azure Container Apps using in Azure CLI",authors:["kgal-akl"],tags:["microsoft","azure","cloud","user","managed_identity","federation","az","cli","ad","entra_id"]},o=void 0,t={id:"cloud_services/azure/container_app",title:"Managing Azure Container Apps using in Azure CLI",description:"Deploy/Upgrade a Container App using Bicep",source:"@site/docs/cloud_services/azure/container_app.md",sourceDirName:"cloud_services/azure",slug:"/cloud_services/azure/managing-azure-container-app",permalink:"/docs/cloud_services/azure/managing-azure-container-app",draft:!1,unlisted:!1,tags:[{inline:!0,label:"microsoft",permalink:"/docs/tags/microsoft"},{inline:!0,label:"azure",permalink:"/docs/tags/azure"},{inline:!0,label:"cloud",permalink:"/docs/tags/cloud"},{inline:!0,label:"user",permalink:"/docs/tags/user"},{inline:!0,label:"managed_identity",permalink:"/docs/tags/managed-identity"},{inline:!0,label:"federation",permalink:"/docs/tags/federation"},{inline:!0,label:"az",permalink:"/docs/tags/az"},{inline:!0,label:"cli",permalink:"/docs/tags/cli"},{inline:!0,label:"ad",permalink:"/docs/tags/ad"},{inline:!0,label:"entra_id",permalink:"/docs/tags/entra-id"}],version:"current",frontMatter:{slug:"managing-azure-container-app",title:"Managing Azure Container Apps using in Azure CLI",authors:["kgal-akl"],tags:["microsoft","azure","cloud","user","managed_identity","federation","az","cli","ad","entra_id"]},sidebar:"docsSidebar",previous:{title:"Managing AKS in Azure",permalink:"/docs/cloud_services/azure/managing-aks-azure"},next:{title:"Azure Authentication using IMDS",permalink:"/docs/cloud_services/azure/azure-auth-imdsv2"}},c={},p=[{value:"Deploy/Upgrade a Container App using Bicep",id:"deployupgrade-a-container-app-using-bicep",level:2},{value:"Show Container App",id:"show-container-app",level:2},{value:"Show Container App Logs",id:"show-container-app-logs",level:2},{value:"Access Container App",id:"access-container-app",level:2}];function l(n){const e={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"deployupgrade-a-container-app-using-bicep",children:"Deploy/Upgrade a Container App using Bicep"}),"\n",(0,i.jsx)(e.p,{children:"To deploy or upgrade an Azure Container App it using a Bicep template and parameters:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'az deployment group create \\\n--resource-group "$AZURE_RESOURCE_GROUP" \\\n--template-file main.bicep \\\n--parameters main.parameters.json \\\n\n# OR\n# --parameters \\\n    # location="$AZURE_LOCATION" \\\n    # acaEnvName="$ACA_ENV_NAME" \\\n    # acaAppName="$ACA_APP_NAME" \\\n    # uamiName="$ACA_UAMI_NAME" \\\n    # parameter1="$PARAM_1"\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"main.parameters.json"})," uses ",(0,i.jsxs)(e.a,{href:"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json",children:[(0,i.jsx)(e.code,{children:"deployParameters"})," JSON schema"]}),". Here's a sample:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",\n    "contentVersion": "1.0.0.0",\n    "parameters": {\n      "location": { "value": "eastus" },\n      "acaEnvName": { "value": "kgal-aca-wid-env" },\n      "acaAppName": { "value": "kgal-aca-wid-gw" },\n      "uamiName": { "value": "kgal-aca-wid-uami" },\n      "containerImage": { "value": "docker.registry.kbbgl.dev/app:tag" },\n      "appUrl": { "value": "https://kbbgl.github.io/app" },\n      "cpu": { "value": "2.0" },\n      "memory": { "value": "4Gi" }\n    }\n  }\n'})}),"\n",(0,i.jsxs)(e.p,{children:["And ",(0,i.jsx)(e.code,{children:"main.bicep"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"targetScope = 'resourceGroup'\n\n@description('Azure location')\nparam location string = resourceGroup().location\n\n@description('Container Apps environment name')\nparam acaEnvName string\n\n@description('Container App name')\nparam acaAppName string\n\n@description('User assigned managed identity name')\nparam uamiName string\n\n@description('Container image')\nparam containerImage string = 'docker.registry.kbbgl.dev/app:tag'\n\n@description('App URL')\nparam appUrl string = 'https://app.kbbgl.github.io'\n\n@description('CPU cores')\nparam cpu string = '2.0'\n\n@description('Memory')\nparam memory string = '4Gi'\n\nresource logAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name: '${acaEnvName}-law'\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n    retentionInDays: 30\n  }\n}\n\nresource uami 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {\n  name: uamiName\n  location: location\n}\n\nresource acaEnv 'Microsoft.App/managedEnvironments@2024-03-01' = {\n  name: acaEnvName\n  location: location\n  properties: {\n    appLogsConfiguration: {\n      destination: 'log-analytics'\n      logAnalyticsConfiguration: {\n        customerId: logAnalytics.properties.customerId\n        sharedKey: listKeys(logAnalytics.id, '2022-10-01').primarySharedKey\n      }\n    }\n  }\n}\n\nresource acaApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: acaAppName\n  location: location\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${uami.id}': {}\n    }\n  }\n  properties: {\n    managedEnvironmentId: acaEnv.id\n    configuration: {\n      ingress: {\n        external: true\n        targetPort: 80\n        transport: 'auto'\n      }\n    }\n    template: {\n      containers: [\n        {\n          name: 'app'\n          image: containerImage\n          env: [\n            { name: 'APP_URL', value: appUrl }\n          ]\n          resources: {\n            cpu: json(cpu)\n            memory: memory\n          }\n        }\n      ]\n      scale: {\n        minReplicas: 1\n        maxReplicas: 1\n      }\n    }\n  }\n}\n\noutput uamiResourceId string = uami.id\noutput uamiClientId string = uami.properties.clientId\noutput acaFqdn string = acaApp.properties.configuration.ingress.fqdn\noutput acaResourceId string = acaApp.id\n"})}),"\n",(0,i.jsx)(e.h2,{id:"show-container-app",children:"Show Container App"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'az containerapp show \\\n--name "$ACA_APP_NAME" \\\n--resource-group "$AZURE_RESOURCE_GROUP" \\\n--output yaml\n'})}),"\n",(0,i.jsx)(e.h2,{id:"show-container-app-logs",children:"Show Container App Logs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'az containerapp logs show \\\n--name "$ACA_APP_NAME" \\\n--resource-group "$AZURE_RESOURCE_GROUP" \\\n--follow\n'})}),"\n",(0,i.jsx)(e.h2,{id:"access-container-app",children:"Access Container App"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'az containerapp exec \\\n--name "$ACA_APP_NAME" \\\n--resource-group "$AZURE_RESOURCE_GROUP" \\\n--container app \\\n--command "/bin/sh"\n'})})]})}function d(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}},28453:(n,e,a)=>{a.d(e,{R:()=>o,x:()=>t});var i=a(96540);const r={},s=i.createContext(r);function o(n){const e=i.useContext(s);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);