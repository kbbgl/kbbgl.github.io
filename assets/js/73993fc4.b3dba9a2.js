"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[4773],{2298:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var r=t(74848),s=t(28453);const i={slug:"how-to-setup-gitlab-self-hosted-runner",title:"How to Set Up GitLab Self-Hosted Runner",description:"Steps to set up GitLab Self-Hosted Runner",authors:["kgal-akl"],tags:["cicd","ci","gitlab","self-hosted"]},o=void 0,a={id:"software/cicd/gitlab-self-hosted-runner",title:"How to Set Up GitLab Self-Hosted Runner",description:"Steps to set up GitLab Self-Hosted Runner",source:"@site/docs/software/cicd/gitlab-self-hosted-runner.md",sourceDirName:"software/cicd",slug:"/software/cicd/how-to-setup-gitlab-self-hosted-runner",permalink:"/docs/software/cicd/how-to-setup-gitlab-self-hosted-runner",draft:!1,unlisted:!1,tags:[{inline:!0,label:"cicd",permalink:"/docs/tags/cicd"},{inline:!0,label:"ci",permalink:"/docs/tags/ci"},{inline:!0,label:"gitlab",permalink:"/docs/tags/gitlab"},{inline:!0,label:"self-hosted",permalink:"/docs/tags/self-hosted"}],version:"current",frontMatter:{slug:"how-to-setup-gitlab-self-hosted-runner",title:"How to Set Up GitLab Self-Hosted Runner",description:"Steps to set up GitLab Self-Hosted Runner",authors:["kgal-akl"],tags:["cicd","ci","gitlab","self-hosted"]},sidebar:"docsSidebar",previous:{title:"How to Set Up Chaos Mesh on Kubernetes using Helm",permalink:"/docs/software/chaos/how-to-setup-chaos-mesh-k8s-helm"},next:{title:"Get Container Resource Usage",permalink:"/docs/software/containerization/docker/admin/get-list-containers-resource-usage"}},c={},l=[{value:"Register Runner",id:"register-runner",level:2},{value:"Running GitLab Pipeline in Docker",id:"running-gitlab-pipeline-in-docker",level:2},{value:"Managing Runners",id:"managing-runners",level:2},{value:"Configuration",id:"configuration",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"register-runner",children:"Register Runner"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gitlab-runner register \\\n\t--url https://gitlab.com \\\n\t--token glrt-$TOKEN \\\n\t--tag-list macos\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Token can be by creating one in ",(0,r.jsx)(n.a,{href:"https://docs.gitlab.com/user/profile/personal_access_tokens",children:"Personal access tokens"}),". When we register a runner, we will be asked to add tags to the runner. Tags control what runner will actually run the pipeline."]}),"\n",(0,r.jsx)(n.h2,{id:"running-gitlab-pipeline-in-docker",children:"Running GitLab Pipeline in Docker"}),"\n",(0,r.jsx)(n.p,{children:"We need to create a GitLab volume to persist the configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker create volume gitlab-runner-config\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We then run ",(0,r.jsx)(n.code,{children:"gitlab-runner"})," daemon in Docker:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d --name gitlab-runner \\\n--restart always \\\n-v /var/run/docker.sock:/var/run/docker.sock \\\n-v gitlab-runner-config:/etc/gitlab-runner \\\n-v /Users/kgal/.gitlab-runner/config.toml:/etc/gitlab-runner/config.toml \\\ngitlab/gitlab-runner:latest;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We then trigger a pipeline in GitLab. In the pipeline defined in ",(0,r.jsx)(n.code,{children:"gitlab-ci.yaml"}),", if we register the ",(0,r.jsx)(n.code,{children:"macos"})," tag to the runner and then later add the same tag to ",(0,r.jsx)(n.code,{children:"get-resource-job.tags[0]"})," as below:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'variables:\n  ACCOUNT_ID: 123456\n  FQDN: http://some.domain.dev\n  OUT: /tmp/res\n\nstages:\n  - get_resource\n\nget-resource-job:\n  stage: get_resource\n  image: alpine/ci:0.0.1\n  tags:\n    - macos\n  before_script:\n    - echo "getting resource..."\n    - curl "$FQDN/get/resource" -H "x-acc-id: $ACCOUNT_ID" > $OUT\n  script:\n    - echo "done getting resource, saved in \'$OUT\'"\n'})}),"\n",(0,r.jsx)(n.p,{children:"We should see the following output where we can see that the job was trigger in our local Docker:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker logs -f gitlab-runner\nRuntime platform                                    arch=arm64 os=linux pid=7 revision=4d7093e1 version=18.0.2\nStarting multi-runner from /etc/gitlab-runner/config.toml...  builds=0 max_builds=0\nRunning in system-mode.\n\nUsage logger disabled                               builds=0 max_builds=1\nConfiguration loaded                                builds=0 max_builds=1\nlisten_address not defined, metrics & debug endpoints disabled  builds=0 max_builds=1\n[session_server].listen_address not defined, session endpoints disabled  builds=0 max_builds=1\nInitializing executor providers                     builds=0 max_builds=1\nChecking for jobs... received                       job=10227995527 repo_url=https://gitlab.com/kbbgl/demo.git runner=9mUX02bq0\nAdded job to processing list                        builds=1 job=10227995527 max_builds=1 project=70251116 repo_url=https://gitlab.com/kbbgl/demo.git time_in_queue_seconds=0\nAppending trace to coordinator...ok                 code=202 job=10227995527 job-log=0-2859 job-status=running runner=9mUX02bq0 sent-log=0-2858 status=202 Accepted update-interval=3s\nJob succeeded                                       duration_s=5.574595877 job=10227995527 project=70251116 runner=9mUX02bq0\nAppending trace to coordinator...ok                 code=202 job=10227995527 job-log=0-3559 job-status=running runner=9mUX02bq0 sent-log=2859-3558 status=202 Accepted update-interval=3s\nUpdating job...                                     bytesize=3559 checksum=crc32:1c8e0aee job=10227995527 runner=9mUX02bq0\nSubmitting job to coordinator...accepted, but not yet completed  bytesize=3559 checksum=crc32:1c8e0aee code=202 job=10227995527 job-status=running runner=9mUX02bq0 update-interval=1s\nUpdating job...                                     bytesize=3559 checksum=crc32:1c8e0aee job=10227995527 runner=9mUX02bq0\nSubmitting job to coordinator...ok                  bytesize=3559 checksum=crc32:1c8e0aee code=200 job=10227995527 job-status=success runner=9mUX02bq0 update-interval=0s\nRemoved job from processing list                    builds=0 job=10227995527 max_builds=1 project=70251116 repo_url=https://gitlab.com/kbbgl/demo.git time_in_queue_seconds=0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"managing-runners",children:"Managing Runners"}),"\n",(0,r.jsx)(n.p,{children:"We can see what runners are registered:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gitlab-runner list\n"})}),"\n",(0,r.jsx)(n.p,{children:"We can start/stop the service and check the status:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gitlab-runner stop\ngitlab-runner start\ngitlab-runner status\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cat ~/.gitlab-runner/config.toml\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(96540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);