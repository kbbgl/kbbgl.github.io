"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[60859],{54442:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>r,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>a});var o=c(74848),t=c(28453);const l={title:"Google Kubernetes Engine",slug:"gke",tags:["kubectl","cloud","cli","gke","k8s","kubernetes"],authors:["kgal-akl"]},i=void 0,s={id:"cloud_services/gcloud/gke",title:"Google Kubernetes Engine",description:"Configure GKE cluster with kubectl",source:"@site/docs/cloud_services/gcloud/gke.md",sourceDirName:"cloud_services/gcloud",slug:"/cloud_services/gcloud/gke",permalink:"/docs/cloud_services/gcloud/gke",draft:!1,unlisted:!1,tags:[{inline:!0,label:"kubectl",permalink:"/docs/tags/kubectl"},{inline:!0,label:"cloud",permalink:"/docs/tags/cloud"},{inline:!0,label:"cli",permalink:"/docs/tags/cli"},{inline:!0,label:"gke",permalink:"/docs/tags/gke"},{inline:!0,label:"k8s",permalink:"/docs/tags/k-8-s"},{inline:!0,label:"kubernetes",permalink:"/docs/tags/kubernetes"}],version:"current",frontMatter:{title:"Google Kubernetes Engine",slug:"gke",tags:["kubectl","cloud","cli","gke","k8s","kubernetes"],authors:["kgal-akl"]},sidebar:"docsSidebar",previous:{title:"Copy Files from/to Remote",permalink:"/docs/cloud_services/gcloud/gcloud-cp-files-from-to-remote"},next:{title:"Google Cloud CLI IAM Cheatsheet",permalink:"/docs/cloud_services/gcloud/gcloud-iam-cheatsheet"}},r={},a=[{value:"Configure GKE cluster with <code>kubectl</code>",id:"configure-gke-cluster-with-kubectl",level:2},{value:"Configure Ingress",id:"configure-ingress",level:2},{value:"Create Service Account",id:"create-service-account",level:2},{value:"Enable Workload Identity in GKE",id:"enable-workload-identity-in-gke",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.h2,{id:"configure-gke-cluster-with-kubectl",children:["Configure GKE cluster with ",(0,o.jsx)(n.code,{children:"kubectl"})]}),"\n",(0,o.jsxs)(n.p,{children:["After creating a GKE cluster, we can configure ",(0,o.jsx)(n.code,{children:"kubectl"})," to interact with the GKE cluster using:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"GKE_CLUSTER_NAME=kgal-gke-cluster\nGCP_PROJECT=kgal-dev\nGCP_REGION=us-east4\nGKE_CLUSTER_ZONE=$GCP_REGION\nGCP_SA=my-app-gsa\nGCP_SA_NAMEPSACE=default\n\ngcloud container clusters get-credentials $GKE_CLUSTER_NAME --region $GCP_REGION --project $GCP_PROJECT\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This will append a new user, context and cluster to ",(0,o.jsx)(n.code,{children:"~/.kube/config"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"configure-ingress",children:"Configure Ingress"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl create clusterrolebinding cluster-admin-binding \\\n  --clusterrole cluster-admin \\\n  --user $(gcloud config get-value account)\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.12.1/deploy/static/provider/cloud/deploy.yaml\n"})}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"https://kubernetes.github.io/ingress-nginx/deploy/#gce-gke",children:"this"})," for more info."]}),"\n",(0,o.jsx)(n.h2,{id:"create-service-account",children:"Create Service Account"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Create a Google Service Account (GSA)\ngcloud iam service-accounts create $GCP_SA \\\n--display-name="My Application GSA" \\\n--project $GCP_PROJECT\n\n# Assign required IAM roles to\xa0`my-app-gsa@$GCP_PROJECT.iam.gserviceaccount.com`_\ngcloud projects add-iam-policy-binding $GCP_PROJECT \\\n--member="serviceAccount:$GCP_SA@$GCP_PROJECT.iam.gserviceaccount.com" \\\n--role="roles/storage.objectViewer"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"enable-workload-identity-in-gke",children:"Enable Workload Identity in GKE"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Check if it\'s already enabled\ngcloud container clusters describe $GKE_CLUSTER_NAME \\\n--zone=$GKE_CLUSTER_ZONE \\\n--format="value(workloadIdentityConfig.workloadPool)"\n\n# If it\'s not enabled, enable it\ngcloud container clusters update $GKE_CLUSTER_NAME \\\n--zone=$GKE_CLUSTER_ZONE \\\n--workload-pool=$GCP_PROJECT.svc.id.goog\n  \n# Enable it in the Node Pools as well\n\ngcloud container node-pools update NODE_POOL_NAME \\\n--cluster $GKE_CLUSTER_NAME \\\n--zone $GKE_CLUSTER_ZONE \\\n--enable-workload-identity\n\n# Create an IAM binding allowing the Kubernetes ServiceAccount to impersonate the GCP service account:\ngcloud iam service-accounts add-iam-policy-binding \\\n$GCP_SA@$GCP_PROJECT.iam.gserviceaccount.com \\\n--role roles/iam.workloadIdentityUser \\\n--member "serviceAccount:$GCP_PROJECT.svc.id.goog[$GCP_SA_NAMEPSACE/$GCP_SA]"\n'})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,c)=>{c.d(n,{R:()=>i,x:()=>s});var o=c(96540);const t={},l=o.createContext(t);function i(e){const n=o.useContext(l);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(l.Provider,{value:n},e.children)}}}]);