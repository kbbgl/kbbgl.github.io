"use strict";(self.webpackChunkkgkb=self.webpackChunkkgkb||[]).push([[53890],{89811:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var r=s(74848),o=s(28453);const t={},i="Architecture Layers",a={id:"os/UNIX/Network/Remote Access/OpenSSH",title:"Architecture Layers",description:"Transport Layer",source:"@site/docs/os/UNIX/Network/Remote Access/OpenSSH.md",sourceDirName:"os/UNIX/Network/Remote Access",slug:"/os/UNIX/Network/Remote Access/OpenSSH",permalink:"/docs/os/UNIX/Network/Remote Access/OpenSSH",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Virtual Local Area Network",permalink:"/docs/os/UNIX/Network/Protocols/VLAN"},next:{title:"SSH Autologin Setup",permalink:"/docs/os/UNIX/Network/Remote Access/ssh_key_setup_autologin"}},c={},l=[{value:"Transport Layer",id:"transport-layer",level:2},{value:"User Authentication Layer",id:"user-authentication-layer",level:2},{value:"Connection Layer",id:"connection-layer",level:2},{value:"SSH Session Overview",id:"ssh-session-overview",level:3},{value:"OpenSSH Client",id:"openssh-client",level:3},{value:"OpenSSH Server",id:"openssh-server",level:3},{value:"Per-User OpenSSH Configuration",id:"per-user-openssh-configuration",level:3},{value:"OpenSSH Key-Based Authentication",id:"openssh-key-based-authentication",level:3},{value:"Tunnel",id:"tunnel",level:3},{value:"Local Tunnel (-L)",id:"local-tunnel--l",level:4},{value:"Remote Tunnel (-R)",id:"remote-tunnel--r",level:4},{value:"Dynamic Port Forwarding (-B)",id:"dynamic-port-forwarding--b",level:4},{value:"Parallel SSH Commands",id:"parallel-ssh-commands",level:3},{value:"Virtual Network Computing (VNC) Server",id:"virtual-network-computing-vnc-server",level:3},{value:"VNC Client",id:"vnc-client",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"architecture-layers",children:"Architecture Layers"})}),"\n",(0,r.jsx)(n.h2,{id:"transport-layer",children:"Transport Layer"}),"\n",(0,r.jsx)(n.p,{children:"Deals with the initial key-exchange and setting up a symmetric-key session."}),"\n",(0,r.jsx)(n.h2,{id:"user-authentication-layer",children:"User Authentication Layer"}),"\n",(0,r.jsx)(n.p,{children:"Deals with authenticating and authorizing the user accounts."}),"\n",(0,r.jsx)(n.h2,{id:"connection-layer",children:"Connection Layer"}),"\n",(0,r.jsx)(n.p,{children:"Deals with the communication once the session is set up."}),"\n",(0,r.jsx)(n.h3,{id:"ssh-session-overview",children:"SSH Session Overview"}),"\n",(0,r.jsx)(n.p,{children:"An SSH session starts with the Transport Layer, which sets up the Connection Layer. SSH communications then happen over the Connection Layer."}),"\n",(0,r.jsx)(n.h3,{id:"openssh-client",children:"OpenSSH Client"}),"\n",(0,r.jsxs)(n.p,{children:["The OpenSSH host-wide client configuration is ",(0,r.jsx)(n.code,{children:"/etc/ssh/ssh_config"}),". The per-user client configuration is",(0,r.jsx)(n.code,{children:"$HOME/.ssh/config"}),". SSH uses a key-based authentication."]}),"\n",(0,r.jsx)(n.p,{children:"The syntax for the client configuration can be found using the command man 5 ssh_config."}),"\n",(0,r.jsx)(n.p,{children:"Other protocols can be tunneled over SSH. The X11 protocol support is part of the OpenSSH client. The VNC protocol support is a part of many different VNC clients."}),"\n",(0,r.jsxs)(n.p,{children:["You can also manually open a connection for any other protocol using the ",(0,r.jsx)(n.code,{children:"LocalForward"})," and ",(0,r.jsx)(n.code,{children:"RemoteForward"})," tokens in the OpenSSH client configuration."]}),"\n",(0,r.jsx)(n.h3,{id:"openssh-server",children:"OpenSSH Server"}),"\n",(0,r.jsxs)(n.p,{children:["The OpenSSH server is configured by editing the ",(0,r.jsx)(n.code,{children:"/etc/ssh/sshd_config"})," file."]}),"\n",(0,r.jsx)(n.p,{children:"Some of the commonly changed server configurations are:"}),"\n",(0,r.jsx)(n.p,{children:"-Disable root access, or allow only key-based root access, using the PermitRootLogin token.\nPermitRootLogin no (No root access)\nPermitRootLogin without-password (Key-only root access)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Disable or enable X11 Forwarding using the ",(0,r.jsx)(n.code,{children:"X11Forwarding"})," token."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"X11Forwarding no\nX11Forwarding yes\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Disable or enable authentication forwarding using the ",(0,r.jsx)(n.code,{children:"AllowAgentForwarding token"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"AllowAgentForwarding yes\nAllowAgentForwarding no\n"})}),"\n",(0,r.jsx)(n.h3,{id:"per-user-openssh-configuration",children:"Per-User OpenSSH Configuration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"$HOME/.ssh/config"})," can be set up with shortcuts to servers you frequently access. Advanced, user-specific options are also available. The following is an example of how you can use ssh web:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Host web\n\n     HostName www.example.com\n     User webusr\n"})}),"\n",(0,r.jsx)(n.p,{children:"This is an example of a more advanced configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ cat ~/.ssh/config\n\nHost web\n\n     KeepAlive yes\n     IdentityFile ~/.ssh/web_id_rsa\n     HostName www.example.com\n     Port 2222\n     User webusr\n     ForwardX11 no\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can find all of the possible options in the ",(0,r.jsx)(n.code,{children:"ssh_config"})," man page:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"man 5 ssh_config\n"})}),"\n",(0,r.jsx)(n.h3,{id:"openssh-key-based-authentication",children:"OpenSSH Key-Based Authentication"}),"\n",(0,r.jsx)(n.p,{children:"OpenSSH client key-based authentication provides a passwordless authentication for users. Private keys can be encrypted and password protected."}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ssh-agent"})," program can cache decrypted private keys."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ssh-copy-id"})," program can copy your public key to a remote host."]}),"\n",(0,r.jsx)(n.p,{children:"To generate a user key for SSH authentication, use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh-keygen -f $HOME/.ssh/id_rsa -N 'supersecret' -t rsa\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To start ",(0,r.jsx)(n.code,{children:"ssh-agent"})," and use it to cache your private key, use:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"eval $(ssh-agent)\nssh-add $HOME/.ssh/id_rsa\n"})}),"\n",(0,r.jsx)(n.p,{children:"To copy your public key to the remote system overthere for remote user joe, use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh-copy-id joe@overthere\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Consult the man pages ",(0,r.jsx)(n.code,{children:"ssh-keygen"}),", ",(0,r.jsx)(n.code,{children:"ssh-add"})," and ",(0,r.jsx)(n.code,{children:"ssh-copy-id"})," for details."]}),"\n",(0,r.jsx)(n.h3,{id:"tunnel",children:"Tunnel"}),"\n",(0,r.jsx)(n.h4,{id:"local-tunnel--l",children:"Local Tunnel (-L)"}),"\n",(0,r.jsx)(n.p,{children:"The local tunnel indicates which port is to be opened on the local host (4242) and the final destination to be, charlie:2200. The connection to the final destination is going to be made by the machine bob."}),"\n",(0,r.jsx)(n.h4,{id:"remote-tunnel--r",children:"Remote Tunnel (-R)"}),"\n",(0,r.jsx)(n.p,{children:"The remote tunnel requests machine bob to open a listening port 2424 to which any connection will be transferred to the destination, charlie:2200."}),"\n",(0,r.jsx)(n.h4,{id:"dynamic-port-forwarding--b",children:"Dynamic Port Forwarding (-B)"}),"\n",(0,r.jsx)(n.p,{children:"The third type of tunneling, dynamic port forwarding, can be found in the ssh man page."}),"\n",(0,r.jsxs)(n.p,{children:["Option ",(0,r.jsx)(n.code,{children:"-N"})," sets the option to not execute a command on connection to the remote system, and option ",(0,r.jsx)(n.code,{children:"-f"})," informs ",(0,r.jsx)(n.code,{children:"ssh"})," to go into background just before command execution."]}),"\n",(0,r.jsx)(n.h3,{id:"parallel-ssh-commands",children:"Parallel SSH Commands"}),"\n",(0,r.jsx)(n.p,{children:"Often, it is required to execute the same command on many systems to help facilitate this. The pssh package is available for most distributions. The pssh package typically includes:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pssh"}),": parallel ssh\n",(0,r.jsx)(n.code,{children:"pnuke"}),": parallel process kill\n",(0,r.jsx)(n.code,{children:"prsync"}),": parallel copy program using rsync\n",(0,r.jsx)(n.code,{children:"pscp"}),": parallel copy using scp\n",(0,r.jsx)(n.code,{children:"pslurp"}),": parallel copy from hosts.\nThe program names may be slightly different on the different distributions."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"pssh"})," command and friends use the existing ",(0,r.jsx)(n.code,{children:"ssh"})," configuration. It is best to configure aliases, keys, known hosts and authorized keys prior to attempting to use pssh."]}),"\n",(0,r.jsx)(n.p,{children:"If there is a password or fingerprint prompt, the pssh command will fail."}),"\n",(0,r.jsxs)(n.p,{children:["When using ",(0,r.jsx)(n.code,{children:"pssh"}),", it is convenient to create a file with a list of the hosts you wish to access. The list can contain IP addresses or hostnames. An example is provided below:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ cat ~/ips.txt\n\n127.0.0.1\n192.168.42.1\n\n$ pssh -i -h ~/ips.txt date\n\n[1] 10:07:35 [SUCCESS] 120.0.0.1\nThu Sep 28 10:07:35 CDT 2017\n[2] 10:07:35 [SUCCESS] 192.168.42.1\nThu Sep 28 10:07:35 CDT 2017\n"})}),"\n",(0,r.jsx)(n.h3,{id:"virtual-network-computing-vnc-server",children:"Virtual Network Computing (VNC) Server"}),"\n",(0,r.jsxs)(n.p,{children:["The Virtual Network Computing (VNC) server allows for cross-platform, graphical remote access. There are several implementations available; the current common version is tigervnc client and server. The server component has ",(0,r.jsx)(n.code,{children:"Xvnc"})," (the main server for VNC and X), ",(0,r.jsx)(n.code,{children:"vncserver"})," (Perl script to control Xvnc), ",(0,r.jsx)(n.code,{children:"vncpasswd"})," (set and change vnc-only password), and vncconfig (configure and control a running ",(0,r.jsx)(n.code,{children:"Xvnc"}),")."]}),"\n",(0,r.jsxs)(n.p,{children:["To assist in setting up a VNC server session, the ",(0,r.jsx)(n.code,{children:"vncserver"})," script is recommended."]}),"\n",(0,r.jsx)(n.p,{children:"Startup script:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"HOME/.vnc/xstartup\n"})}),"\n",(0,r.jsx)(n.p,{children:"Kill option:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ vncserver -kill <DISPLAYNUM>\n\n$ vncserver\n\nYou will require a password to access your desktops.\nPassword:\nVerify:\nWould you like to enter a view-only password (y/n)? n\nxauth: file /root/.Xauthority does not exist\nxauth: (argv):1: bad display name "host:1" in "add" command\nxauth: file /root/.Xauthority does not exist\nNew \'X\' desktop is host:1\nCreating default startup script /root/.vnc/xstartup\nStarting applications specified in /root/.vnc/xstartup\nLog file is /root/.vnc/host:1.log\nKill option is vncserver -kill <DISPLAYNUM>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When the server starts, it uses the ",(0,r.jsx)(n.code,{children:"xstartup"})," configuration from the users ",(0,r.jsx)(n.code,{children:"//.vnc"})," directory. If the ",(0,r.jsx)(n.code,{children:"xstartup"})," file is altered, the ",(0,r.jsx)(n.code,{children:"vncserver"})," needs to be restarted."]}),"\n",(0,r.jsx)(n.h3,{id:"vnc-client",children:"VNC Client"}),"\n",(0,r.jsx)(n.p,{children:"VNC is a display-based protocol, which makes it cross-platform. It also means that it is a relatively heavy protocol, as pixel updates have to be sent over-the-wire."}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"vncserver"})," opens ports starting from 5901 and up. The display number :1 may also be used."]}),"\n",(0,r.jsxs)(n.p,{children:["The client, ",(0,r.jsx)(n.code,{children:"vncviewer"}),", is usually packaged separately. It connects to the VNC server on the specified port or display number. Passwords are not sent in clear text."]}),"\n",(0,r.jsx)(n.p,{children:"On its own, VNC is not secure after the authentication step. However, the protocol can be tunneled through SSH or VPN connections."})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var r=s(96540);const o={},t=r.createContext(o);function i(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);