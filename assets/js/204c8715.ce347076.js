"use strict";(self.webpackChunkkgkb=self.webpackChunkkgkb||[]).push([[44863],{79093:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>a});var i=t(74848),s=t(28453);const r={},l="netfilter Vocabulary",o={id:"os/UNIX/Network/Firewalls/netfilter",title:"netfilter Vocabulary",description:"netfilter is a packet-filtering framework built into the Linux kernel. To better understand netfilter, we need to start with some vocabulary:",source:"@site/docs/os/UNIX/Network/Firewalls/netfilter.md",sourceDirName:"os/UNIX/Network/Firewalls",slug:"/os/UNIX/Network/Firewalls/netfilter",permalink:"/docs/os/UNIX/Network/Firewalls/netfilter",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"iptables Command",permalink:"/docs/os/UNIX/Network/Firewalls/iptables_Command"},next:{title:"Linux Containers (LXC)",permalink:"/docs/os/UNIX/Network/LXC Virtualization/Overview"}},c={},a=[{value:"Configuration Utilities",id:"configuration-utilities",level:2},{value:"<code>netfilter</code> Hooks",id:"netfilter-hooks",level:2},{value:"<code>nftables</code> Configuration Structure",id:"nftables-configuration-structure",level:2},{value:"<code>nft</code> Administration Interfaces",id:"nft-administration-interfaces",level:2},{value:"<code>nft</code> File Locations",id:"nft-file-locations",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"netfilter-vocabulary",children:"netfilter Vocabulary"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"netfilter"})," is a packet-filtering framework built into the Linux kernel. To better understand ",(0,i.jsx)(n.code,{children:"netfilter"}),", we need to start with some vocabulary:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The netfilter firewall consists of tables."}),"\n",(0,i.jsx)(n.li,{children:"Tables consist of chains."}),"\n",(0,i.jsx)(n.li,{children:"Chains have a default policy."}),"\n",(0,i.jsx)(n.li,{children:"Chains consist of rules."}),"\n",(0,i.jsx)(n.li,{children:"Rules consist of a match criteria and a target."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Rules in each chain are read first to last, and the first match wins. If a packet does not match any rule in a chain, the policy of the chain applies."}),"\n",(0,i.jsx)(n.h2,{id:"configuration-utilities",children:"Configuration Utilities"}),"\n",(0,i.jsxs)(n.p,{children:["Because of the inherent complexity of the ",(0,i.jsx)(n.code,{children:"netfilter"})," management, many tools have been created to help alleviate the burden on systems administrators. The CentOS ",(0,i.jsx)(n.code,{children:"system-config-firewall"}),", the Ubuntu ",(0,i.jsx)(n.code,{children:"gufw"}),", and the OpenSUSE ",(0,i.jsx)(n.code,{children:"yast"})," firewall are examples of configuration utilities."]}),"\n",(0,i.jsx)(n.p,{children:"Each distribution has its own GUI or TUI mode firewall tool."}),"\n",(0,i.jsx)(n.p,{children:"There are also generic tools like shorewall, which wrap the complexity of iptables/netfilter in an API."}),"\n",(0,i.jsxs)(n.p,{children:["The latest addition to firewall management is ",(0,i.jsx)(n.code,{children:"firewalld"}),". The ",(0,i.jsx)(n.code,{children:"firewalld"})," tool is available in most of the recent distributions."]}),"\n",(0,i.jsxs)(n.h2,{id:"netfilter-hooks",children:[(0,i.jsx)(n.code,{children:"netfilter"})," Hooks"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"nftables"})," is an update to packet filtering for the ",(0,i.jsx)(n.code,{children:"netfilter"})," framework. ",(0,i.jsx)(n.code,{children:"nftables"})," replaces:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"iptables"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ip6tables"}),"\n-",(0,i.jsx)(n.code,{children:"arptables"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ebtables"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Most of the concepts from ",(0,i.jsx)(n.code,{children:"netfilter"})," apply to ",(0,i.jsx)(n.code,{children:"nftables"}),". One major change is the hooks into the network stack. In ",(0,i.jsx)(n.code,{children:"netfilter"})," the hooks are pre-defined and known as ",(0,i.jsx)(n.code,{children:"filter"}),", ",(0,i.jsx)(n.code,{children:"raw"}),", ",(0,i.jsx)(n.code,{children:"nat"}),", etc."]}),"\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.code,{children:"nftables"})," the hooks are not connected by default. The hooks have to be connected to chains by the administrator, as they are not pre-configured."]}),"\n",(0,i.jsx)(n.p,{children:"There are hooks for several types of packets such as:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ip"})," - IPv4 address family"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ip6"})," - IPv6 address family"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"inet"})," - Internet (IPv4/IPv6) address family"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"arp"})," - ARP family, handling IPv4 ARP"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bridge"})," - Handles packets transversing a bridge device."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"netdev"})," - netdev address family, handling packets from ingress."]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"nftables-configuration-structure",children:[(0,i.jsx)(n.code,{children:"nftables"})," Configuration Structure"]}),"\n",(0,i.jsx)(n.p,{children:"Once the requirements are known, the configuration can be added, building the structure as needed. In our example on the next page, the requirements are sparse and intended only as examples. You could add the configuration in a number of ways:"}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"nft"})," commands:\nThe commands can be issued one at a time from the command line."]}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"nft"})," shell:\nA non-interactive shell is available that will process through a file. The format of the file is the same as the nft commands with the nft removed."]}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"nft -f filename"}),":\nAn atomic method of changing the ",(0,i.jsx)(n.code,{children:"nftables"})," configuration. The command uses an input file formatted like the output of the list command. Here is an example of save, flush, restore, a table configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nft list table inet filter_it > nft.conf\nnft flush ruleset\nnft -f nft.conf\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"nft-administration-interfaces",children:[(0,i.jsx)(n.code,{children:"nft"})," Administration Interfaces"]}),"\n",(0,i.jsxs)(n.p,{children:["One of the common firewall configuration programs, ",(0,i.jsx)(n.code,{children:"firewalld"}),", is compatible with ",(0,i.jsx)(n.code,{children:"nftables"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To switch from ",(0,i.jsx)(n.code,{children:"iptables"})," to ",(0,i.jsx)(n.code,{children:"nftables"})," set the option ",(0,i.jsx)(n.code,{children:"FirewallBackend=nftables"})," in the ",(0,i.jsx)(n.code,{children:"/etc/firewalld/firewalld/conf"})," file. Most distributions have it compiled by default for ",(0,i.jsx)(n.code,{children:"firewalld"})," set to ",(0,i.jsx)(n.code,{children:"iptables"})," and the option may not appear in the file."]}),"\n",(0,i.jsxs)(n.p,{children:["With the support of ",(0,i.jsx)(n.code,{children:"nftables"})," in ",(0,i.jsx)(n.code,{children:"firewalld"}),", the interface options include a GUI and a CLI beyond the basic ",(0,i.jsx)(n.code,{children:"nft"})," command."]}),"\n",(0,i.jsxs)(n.h2,{id:"nft-file-locations",children:[(0,i.jsx)(n.code,{children:"nft"})," File Locations"]}),"\n",(0,i.jsx)(n.p,{children:"It's very important to know that locations may change, so make sure to check your distribution."}),"\n",(0,i.jsxs)(n.p,{children:["The key file locations for ",(0,i.jsx)(n.code,{children:"nft"})," in the Fedora 30 release are the ",(0,i.jsx)(n.code,{children:"systemd"})," top level configuration file ",(0,i.jsx)(n.code,{children:"/usr/lib/systemd/system/nftables.service"}),", which points to the ",(0,i.jsx)(n.code,{children:"nft"})," configuration file, ",(0,i.jsx)(n.code,{children:"/etc/sysconfig/nftables.conf"})," file, that includes the configuration files in the directory ",(0,i.jsx)(n.code,{children:"/etc/nftables/*.nft"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);