"use strict";(globalThis.webpackChunkkgkb=globalThis.webpackChunkkgkb||[]).push([[64997],{64957:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>x,frontMatter:()=>a,metadata:()=>r,toc:()=>t});var i=s(74848),o=s(28453);const a={slug:"os-macos-darwin-sandbox-exec",title:"`sandbox-exec` (macOS): command-line sandboxing",authors:["kbbgl"],tags:["os","macos","darwin","sandbox_exec"]},l="sandbox-exec (macOS): command-line sandboxing",r={id:"os/macos_darwin/sandbox-exec",title:"`sandbox-exec` (macOS): command-line sandboxing",description:"sandbox-exec is a built-in macOS command-line utility that runs a program inside a sandbox defined by a sandbox profile (a small Scheme/LISP-like policy file). The basic idea is to deny or allow specific operations (network, file reads/writes, process exec, etc.) so a command can only access what you explicitly permit.",source:"@site/docs/os/macos_darwin/sandbox-exec.md",sourceDirName:"os/macos_darwin",slug:"/os/macos_darwin/os-macos-darwin-sandbox-exec",permalink:"/docs/os/macos_darwin/os-macos-darwin-sandbox-exec",draft:!1,unlisted:!1,tags:[{inline:!0,label:"os",permalink:"/docs/tags/os"},{inline:!0,label:"macos",permalink:"/docs/tags/macos"},{inline:!0,label:"darwin",permalink:"/docs/tags/darwin"},{inline:!0,label:"sandbox_exec",permalink:"/docs/tags/sandbox-exec"}],version:"current",frontMatter:{slug:"os-macos-darwin-sandbox-exec",title:"`sandbox-exec` (macOS): command-line sandboxing",authors:["kbbgl"],tags:["os","macos","darwin","sandbox_exec"]},sidebar:"docsSidebar",previous:{title:"Keyboard Shortcuts",permalink:"/docs/os/macos_darwin/os-macos-darwin-mac-shortcuts"},next:{title:"Enable Running Remote Commands",permalink:"/docs/os/windows/admin/os-windows-admin-enable-running-remote-commands"}},d={},t=[{value:"Quick start",id:"quick-start",level:2},{value:"Sandbox profile basics",id:"sandbox-profile-basics",level:2},{value:"Two common strategies",id:"two-common-strategies",level:2},{value:"Deny-by-default (more secure)",id:"deny-by-default-more-secure",level:3},{value:"Allow-by-default (more convenient)",id:"allow-by-default-more-convenient",level:3},{value:"Practical examples",id:"practical-examples",level:2},{value:"Sandboxed terminal session (no network + limited personal file reads)",id:"sandboxed-terminal-session-no-network--limited-personal-file-reads",level:3},{value:"Use pre-built system profiles",id:"use-pre-built-system-profiles",level:3},{value:"Import and extend an existing profile",id:"import-and-extend-an-existing-profile",level:3},{value:"Inline profile (good for quick \u201cno network\u201d)",id:"inline-profile-good-for-quick-no-network",level:3},{value:"Debugging: \u201cwhy did my app fail in the sandbox?\u201d",id:"debugging-why-did-my-app-fail-in-the-sandbox",level:2},{value:"Console.app",id:"consoleapp",level:3},{value:"Live sandbox violation logs",id:"live-sandbox-violation-logs",level:3},{value:"Useful use cases",id:"useful-use-cases",level:2},{value:"Limitations / caveats",id:"limitations--caveats",level:2},{value:"Sources",id:"sources",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"sandbox-exec-macos-command-line-sandboxing",children:[(0,i.jsx)(n.code,{children:"sandbox-exec"})," (macOS): command-line sandboxing"]})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sandbox-exec"})," is a built-in macOS command-line utility that runs a program inside a sandbox defined by a ",(0,i.jsx)(n.strong,{children:"sandbox profile"})," (a small Scheme/LISP-like policy file). The basic idea is to ",(0,i.jsx)(n.strong,{children:"deny or allow specific operations"})," (network, file reads/writes, process exec, etc.) so a command can only access what you explicitly permit."]}),"\n",(0,i.jsxs)(n.p,{children:["Source: ",(0,i.jsx)(n.a,{href:"https://igorstechnoclub.com/sandbox-exec/",children:"sandbox-exec: macOS's Little-Known Command-Line Sandboxing Tool | Igor's Techno Club (2025-04-17)"})]}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick start"}),"\n",(0,i.jsx)(n.p,{children:"Run a command under a profile file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sandbox-exec -f profile.sb command_to_run\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sandbox-profile-basics",children:"Sandbox profile basics"}),"\n",(0,i.jsx)(n.p,{children:"Profiles are built from parenthesized rules. Typical structure:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"(version 1)"})}),"\n",(0,i.jsxs)(n.li,{children:["Default policy: ",(0,i.jsx)(n.code,{children:"(deny default)"})," or ",(0,i.jsx)(n.code,{children:"(allow default)"})]}),"\n",(0,i.jsx)(n.li,{children:"Specific allow/deny rules"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Rules can target paths using:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"literal"})," path: ",(0,i.jsx)(n.code,{children:'(literal "/path/to/file")'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"regex"}),": ",(0,i.jsx)(n.code,{children:'(regex "^/System")'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"subpath"})," (directory subtree): ",(0,i.jsx)(n.code,{children:'(subpath "/Library")'})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"two-common-strategies",children:"Two common strategies"}),"\n",(0,i.jsx)(n.h3,{id:"deny-by-default-more-secure",children:"Deny-by-default (more secure)"}),"\n",(0,i.jsx)(n.p,{children:"Start from \u201cnothing is allowed\u201d, then open up only what\u2019s required:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lisp",children:'(version 1)\n(deny default)\n(allow file-read-data (regex "^/usr/lib"))\n(allow process-exec (literal "/usr/bin/python3"))\n'})}),"\n",(0,i.jsx)(n.p,{children:"This is ideal for untrusted code, but you\u2019ll likely need iterations to make the program functional."}),"\n",(0,i.jsx)(n.h3,{id:"allow-by-default-more-convenient",children:"Allow-by-default (more convenient)"}),"\n",(0,i.jsx)(n.p,{children:"Start from \u201ceverything is allowed\u201d, then block specific risky operations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lisp",children:'(version 1)\n(allow default)\n(deny network*)\n(deny file-write* (regex "^/Users"))\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This is easier to adopt, but it\u2019s also easier to miss a capability you ",(0,i.jsx)(n.em,{children:"meant"})," to deny."]}),"\n",(0,i.jsx)(n.h2,{id:"practical-examples",children:"Practical examples"}),"\n",(0,i.jsx)(n.h3,{id:"sandboxed-terminal-session-no-network--limited-personal-file-reads",children:"Sandboxed terminal session (no network + limited personal file reads)"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"terminal-sandbox.sb"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lisp",children:'(version 1)\n(allow default)\n(deny network*)\n(deny file-read-data (regex "^/Users/[^/]+/(Documents|Pictures|Desktop)"))\n'})}),"\n",(0,i.jsx)(n.p,{children:"Then start a sandboxed shell:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sandbox-exec -f terminal-sandbox.sb zsh\n"})}),"\n",(0,i.jsx)(n.h3,{id:"use-pre-built-system-profiles",children:"Use pre-built system profiles"}),"\n",(0,i.jsxs)(n.p,{children:["macOS ships profiles under ",(0,i.jsx)(n.code,{children:"/System/Library/Sandbox/Profiles"}),". You can use one directly:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sandbox-exec -f /System/Library/Sandbox/Profiles/weatherd.sb command\n"})}),"\n",(0,i.jsx)(n.p,{children:"These can be a good starting point to copy/adapt."}),"\n",(0,i.jsx)(n.h3,{id:"import-and-extend-an-existing-profile",children:"Import and extend an existing profile"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lisp",children:'(version 1)\n(import "/System/Library/Sandbox/Profiles/bsd.sb")\n(deny network*)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"inline-profile-good-for-quick-no-network",children:"Inline profile (good for quick \u201cno network\u201d)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"alias sandbox-no-network='sandbox-exec -p \"(version 1)(allow default)(deny network*)\"'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sandbox-no-network curl -v https://google.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: the source article reports this style didn\u2019t reliably prevent network access for at least one GUI app invocation (Firefox)."}),"\n",(0,i.jsx)(n.h2,{id:"debugging-why-did-my-app-fail-in-the-sandbox",children:"Debugging: \u201cwhy did my app fail in the sandbox?\u201d"}),"\n",(0,i.jsx)(n.h3,{id:"consoleapp",children:"Console.app"}),"\n",(0,i.jsx)(n.p,{children:"Open Console (Applications \u2192 Utilities \u2192 Console), then search for \u201csandbox\u201d and your app name. Look for messages containing \u201cdeny\u201d to see what was blocked."}),"\n",(0,i.jsx)(n.h3,{id:"live-sandbox-violation-logs",children:"Live sandbox violation logs"}),"\n",(0,i.jsx)(n.p,{children:"Stream sandbox logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"log stream --style compact --predicate 'sender==\"Sandbox\"'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Filter for an app (example from the source uses \u201cpython\u201d):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'log stream --style compact --predicate \'sender=="Sandbox" and eventMessage contains "python"\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"useful-use-cases",children:"Useful use cases"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Run untrusted scripts/tools"}),": deny network and restrict reads outside a narrow allowlist."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Privacy guardrails"}),": explicitly deny reads of personal directories (Documents/Pictures/Desktop) for a subprocess."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Safer automation"}),": wrap a one-off data transform so it can\u2019t exfiltrate or overwrite files outside a working directory."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Developer testing"}),": quickly test how an app behaves when permissions are constrained (before doing deeper App Sandbox work)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"limitations--caveats",children:"Limitations / caveats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Apple discourages relying on ",(0,i.jsx)(n.code,{children:"sandbox-exec"})," long-term in favor of App Sandbox (per the source article\u2019s \u201cdeprecation status\u201d note)."]}),"\n",(0,i.jsx)(n.li,{children:"Non-trivial apps can require lots of trial-and-error to permit the minimum needed capabilities."}),"\n",(0,i.jsx)(n.li,{children:"Major macOS updates may change behavior."}),"\n",(0,i.jsx)(n.li,{children:"No GUI for authoring profiles; you need to iterate using logs."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"sources",children:"Sources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://igorstechnoclub.com/sandbox-exec/",children:"sandbox-exec: macOS's Little-Known Command-Line Sandboxing Tool | Igor's Techno Club (2025-04-17)"})}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var i=s(96540);const o={},a=i.createContext(o);function l(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);